/**
 * This file is part of the SJS package.
 * (c) 2010-2011 Stotskiy Sergiy <serjo@freaksidea.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 *//**
 * SJS core
 *
 * @package    SJS
 * @author     Stotskiy Sergiy <serjo@freaksidea.com>
 * @version    SVN: $Id$
 */function sjs(e,t){return e&&(new sjs).create(e,t)}function FileProgress(e,t){this.id=e.id,this.element=null;var n=document.getElementById(this.id),r="";n?(this.element=n.firstChild,this.reset()):(n=document.createElement("div"),n.className="progressWrapper",n.id=this.id,n.style.width="100%",r='<div class="progressContainer"><a href="#" class="progressCancel">&nbsp;</a><div class="progressName">'+e.name,r+='</div><div class="progressBarStatus">&nbsp;</div><div class="progressBarStatik"><span>0</span>%',r+='<div class="progressBarInProgress"></div></div></div>',n.innerHTML=r,this.element=n.firstChild,document.getElementById(t).appendChild(n)),n=null}function fileQueued(e){try{var t=new FileProgress(e,this.customSettings.progressTarget);t.setStatus(sjFileManager.i18n("File added to queue")),t.toggleCancel(!0,this)}catch(n){this.debug(n)}}function fileQueueError(e,t,n){try{if(t===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){alert("You have attempted to queue too many files.\n"+(n===0?"You have reached the upload limit.":"You may select "+(n>1?"up to "+n+" files.":"one file.")));return}var r=new FileProgress(e,this.customSettings.progressTarget);r.setError(),r.toggleCancel(!1);switch(t){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:r.setStatus(sjFileManager.i18n("File is too big")),this.debug("Error Code: File too big, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:r.setStatus(sjFileManager.i18n("Cannot upload Zero Byte files")),this.debug("Error Code: Zero byte file, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:r.setStatus(sjFileManager.i18n("Invalid File Type")),this.debug("Error Code: Invalid File Type, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;default:e!==null&&r.setStatus(sjFileManager.i18n("Unhandled Error")),this.debug("Error Code: "+t+", File name: "+e.name+", File size: "+e.size+", Message: "+n)}}catch(i){this.debug(i)}}function fileDialogComplete(e,t){try{e>0&&(document.getElementById(this.customSettings.cancelButtonId).disabled=!1)}catch(n){this.debug(n)}}function uploadStart(e){try{var t=new FileProgress(e,this.customSettings.progressTarget);t.setStatus(sjFileManager.i18n("Uploading")+"..."),t.toggleCancel(!0,this)}catch(n){}return!0}function uploadProgress(e,t,n){try{var r=Math.ceil(t/n*100),i=new FileProgress(e,this.customSettings.progressTarget);i.setProgress(r),i.setStatus(sjFileManager.i18n("Uploading")+"...")}catch(s){this.debug(s)}}function uploadSuccess(e,t){try{var n=new FileProgress(e,this.customSettings.progressTarget);return t?(n.setError(),n.setStatus(t)):(n.setComplete(),n.setStatus(sjFileManager.i18n("Successfully uploaded")),queueComplete(++this.customSettings.queue_upload_count)),n.toggleCancel(!1),!0}catch(r){return this.debug(r),!1}}function uploadError(e,t,n){try{var r=new FileProgress(e,this.customSettings.progressTarget);r.setError(),r.toggleCancel(!1);switch(t){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:r.setStatus(sjFileManager.i18n("Upload Error")+": "+sjFileManager.i18n(n)),this.debug("Error Code: HTTP Error, File name: "+e.name+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:r.setStatus(sjFileManager.i18n("Upload Failed")),this.debug("Error Code: Upload Failed, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:r.setStatus(sjFileManager.i18n("Server (IO) Error")),this.debug("Error Code: IO Error, File name: "+e.name+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:r.setStatus(sjFileManager.i18n("Security Error")),this.debug("Error Code: Security Error, File name: "+e.name+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:r.setStatus(sjFileManager.i18n("Upload limit exceeded")),this.debug("Error Code: Upload Limit Exceeded, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:r.setStatus(sjFileManager.i18n("Failed Validation. Upload skipped")),this.debug("Error Code: File Validation Failed, File name: "+e.name+", File size: "+e.size+", Message: "+n);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:r.setStatus(sjFileManager.i18n("Cancelled")),r.setCancelled();if(this.getStats().files_queued===0){var i=document.getElementById(this.customSettings.cancelButtonId);i&&(i.disabled=!0)}break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:r.setStatus(sjFileManager.i18n("Stopped"));break;default:r.setStatus(sjFileManager.i18n("Unhandled Error")+": "+t),this.debug("Error Code: "+t+", File name: "+e.name+", File size: "+e.size+", Message: "+n)}}catch(s){this.debug(s)}}function uploadComplete(e){this.getStats().files_queued===0&&(document.getElementById(this.customSettings.cancelButtonId).disabled=!0)}function queueComplete(e){var t=document.getElementById("divStatus");t&&(t.innerHTML=e+" file"+(e===1?"":"s")+" uploaded.")}window.undefined=window.undefined,function(){var e=Array.prototype;e.forEach=e.forEach||function(e,t){sjs.forEach(this,e,t)},e.indexOf=e.indexOf||function(e){return sjs.indexOf(this,e)},e.in_array=function(e){return this.indexOf(e)!=-1},e.unique=function(){return sjs.unique(this)},e.rgb2hex=function(){if(this.length<=0||this.length>3)return!1;var e=this.length,t="",n;while(e--)n=Number(this[e]).toString(16),n.length==1&&(n="0"+n),t=n+t;return"#"+t},e.range=function(e,t){for(var n=e,r=0;n<=t;n++,r++)this[r]=n;return this},e.iterate=function(e){for(var t=0,n=this.length;t<n;t++)e.call(this,this[t],t,this)},e=Function.prototype,e.delay=function(e){var t=this,n=Array.prototype.slice.call(arguments,1);return window.setTimeout(function(){return t.apply(t,n)},e*1e3)},e.periodically=function(e){var t=this,n=Array.prototype.slice.call(arguments,1);return window.setInterval(function(){return t.apply(t,n)},e*1e3)},e.bind||(e.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments,1);return function(){return t.apply(e,n)}}),e=String.prototype,e.hex2rgb=function(){var e=this;if(e.length==4){var t=e.charAt(1),n=e.charAt(2),r=e.charAt(3);e=[parseInt(t+t,16),parseInt(n+n,16),parseInt(r+r,16)]}else e=[parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16),parseInt(e.substr(5,2),16)];return e},e.trim=function(){return sjs.trim(this)},e.space=function(){return sjs.space(this)},e.rSplit=function(e){var t=new Array,n=0,r=this;while(e.test(r))t[n++]=RegExp.leftContext,r=RegExp.rightContext;return n&&(t[n++]=RegExp.leftContext),t},e.ucfirst=function(){var e=this.trim().toLowerCase();return e.substr(0,1).toUpperCase()+e.substr(1)},e=null,Math.rand=function(e,t){return e=parseInt(e),t=parseInt(t),Math.floor(Math.random()*(t-e+1))+e},Number.prototype.round=function(e){return Number(this.toFixed(e||0))},Boolean.xor=function(e,t){return(!e||!t)&&(e||t)}}(),sjs.prototype={sjs:!0,selector:"",getObjectId:function(){return this[0]&&this[0].sjsEventId},toString:function(){return"[object SJSObject]"},valueOf:function(){return this.length},item:function(e){return e==undefined&&Array.prototype.slice.call(this,0)||this[e]},create:function(e,t){if(e.sjs)return e;var n=e,r=0,i="";if(e&&e.constructor==String)/^(?:\s*<(\S+)[^>]*>(?:.*<\/\1>\s*)?)+$/.test(e)?n=sjs.makeHTML(e,t):(this.selector=e,n=sjs.querySelector(e,t));else if(e.nodeName||e==window)n=new Array(e);this.length=r=n.length;while(r--)i=n[r],i&&!i.sjsEventId&&(i.sjsEventId=++sjs.count),this[r]=i;return this},each:function(e){return sjs.forEach(this,e)},iterate:function(e){var t=this.length;while(t--)e.call(this[t],this[t],t,this);return this},filter:function(){var e=arguments.length,t=[this,[]],n=[];while(e--)sjs.isFn(arguments[e])?t[t.length]=arguments[e]:arguments[e].constructor==String&&(n[n.length]=["not",sjs.parseSelector(arguments[e])]);return n.length&&(sjs.setFilters.filt=n,n=null,t.push(sjs.setFilters)),t=sjs.filter.apply(sjs,t),sjs.setFilters.filt=null,sjs(t)},mvc:function(e,t){var n=new Array,r=sjs.globals[e];return this.iterate(function(){var e=r[this.sjsEventId];e&&n.push(e&&e[t]||e)}),n},print:function(e,t,n){return typeof e=="number"?sjs.print(this[e],t,n):sjs.print(this,t,n),this},trigger:function(e){return this.iterate(function(){sjs.event.fire(this,e)!==!1&&sjs.isFn(this[e])&&this[e]()})},onEvent:function(e,t){e="on"+e;var n=function(e){var t=arguments.callee,n;return t.data[0]=e||window.event,n=t.fn.apply(this,t.data),t.data[0]=null,n};return n.fn=t,n.data=Array.prototype.slice.call(arguments,1),n.data[0]=null,this.iterate(function(){sjs.event.attach(this,e,n)})},unlinkEvent:function(e,t){sjs.event.attach(this,e,null)},on:function(e){return this.eventType=e,e="on"+e,this.iterate(function(){this[e]||sjs.event.attach(this,e,sjs.event.call)})},add:function(e){if(sjs.isFn(e)){var t=Array.prototype.slice.call(arguments,0),n=function(e){var t=arguments.callee,n;return t.data[0]=e,n=t.fn.apply(this,t.data),t.data[0]=e=null,n},r=this.eventType;return n.fn=e,n.data=t,n.data[0]=null,this.iterate(function(){sjs.event.add(r,n,this.sjsEventId)})}this.trigger(this.eventType)},dettach:function(e,t){var n=null;return sjs.isFn(t)?n=function(e,t,n){var r=sjs.event[t][n],i=r.length;while(i--&&r[i].fn!==e);return i}:n=function(e){return e},this.iterate(function(){var r=n(t,this.sjsEventId,e);if(r+1){var i=sjs.event[this.sjsEventId][e],s=i.splice(r,1);s.fn=s.args=null,delete s.args,delete s.fn,s=null,i.length||(delete sjs.event[this.sjsEventId][e],sjs.event.attach(this,"on"+e,null))}})},mousewheel:function(e){var t;return this.iterate(function(){t=sjs.event.attachWheel(this,sjs.event.call);if(e){sjs.event.add(t,e,this.sjsEventId);var n=sjs.event[this.sjsEventId];n.DOMMouseScroll&&!n.mousewheel&&(n.mousewheel=n.DOMMouseScroll)}}),this.eventType=t,this},hover:function(e,t){var n=function(t){var n=sjs.event.target(t,"from");try{while(n&&n!=this)n=n.parentNode}catch(t){n=this}return n==this?!1:e.call(this,t)},r=function(e){var n=sjs.event.target(e,"to");try{while(n&&n!=this)n=n.parentNode}catch(e){n=this}return n==this?!1:t.call(this,e)};return this.on("mouseover").add(n).on("mouseout").add(r)},css:function(e,t){if(typeof e!="object")return sjs.isFn(t)?e=="opacity"?this.iterate(function(){sjs.setOpacity(this,t.call(this,e,sjs.css(this,e)))}):this.iterate(function(){this.style[e]=t.call(this,e,sjs.css(this,e))}):e=="opacity"?this.iterate(function(){sjs.setOpacity(this,t)}):this.iterate(function(){this.style[e]=t});if(e.opacity){var n=e.opacity,r=function(t,r){for(var i in e)t.style[i]=e[i];sjs.setOpacity(this,n)};delete e.opacity}else r=function(t,n){for(var r in e)t.style[r]=e[r]};return this.iterate(r)},readCss:function(e){return sjs.css(this[0],e)},getStyle:function(e){return sjs.css(this[0],e)},setClass:function(e){return this.iterate(function(){sjs.className.has(this,e)||sjs.className.set(this,e)})},toogleClass:function(e){return this.iterate(function(){sjs.className.has(this,e)?sjs.className.remove(this,e):sjs.className.set(this,e)})},hasClass:function(e){var t=!1;return this.each(function(){return!(t=sjs.className.has(this,e))}),t},removeClass:function(e){return this.iterate(function(){sjs.className.remove(this,e)})},is:function(e){var t=!0,n=sjs.parseSelector(e);return this.each(function(e,r,i){return t=sjs.filters.not(this,r,i,n)}),!t},fixPng:function(){return this.iterate(function(){sjs.fixPNG(this,sjs.pathToBlankGif)})},attr:function(e,t){var n=function(){sjs.setAttr(this,e,t)};if(typeof e=="object")n=function(){for(var t in e)sjs.setAttr(this,t,e[t])};else if(typeof t==undefined){var r=[];return this.iterate(function(){r.push(sjs.getAttr(this,e))}),r}return this.iterate(n)},attrNode:function(e,t){var n=function(){sjs.setAttrNode(this,e,t)};if(typeof e=="object")n=function(){for(var t in e)sjs.setAttrNode(this,t,e[t])};else if(typeof t==undefined){var r=[];return this.iterate(function(){r.push(sjs.getAttrNode(this,e))}),r}return this.iterate(n)},html:function(e){return typeof e=="undefined"?this[0]&&this[0].innerHTML||"":this.iterate(function(){this.innerHTML=e})},text:function(e){return this.iterate(function(){sjs.setText(this,e)})},prop:function(e,t){if(t==undefined){var n=new Array;return this.iterate(function(){n.push(this[e])}),n}return typeof e=="object"?this.iterate(function(){for(var t in e)this[t]=e[t]}):this.iterate(function(){this[e]=t})},width:function(e,t){return t=t||0,typeof e!="undefined"?e!==0&&(!e||e<0)?this:(/%|px|em|auto$/i.test(e)||(e+="px"),this[t].style.width=e,this):this[t].offsetWidth||this[t].clientWidth||parseInt(sjs.css(this[t],"width"))||0||parseInt(this[t].style.width)||0},height:function(e,t){return t=t||0,typeof e!="undefined"?e!==0&&(!e||e<0)?this:(/%|px|em|auto$/i.test(e)||(e+="px"),this[t].style.height=e,this):this[t].offsetHeight||this[t].clientHeight||parseInt(sjs.css(this[t],"height"))||0||parseInt(this[t].style.height)||0},value:function(e){return this.iterate(function(){this.value=e})},parent:function(e){var t=new Array,n=null,r=null;if(sjs.isFn(e))r=function(r,i,s){var o=this.parentNode;if(!o||n==o)return!0;e.call(o,r,i,s),n=t[t.length]=o};else if(Number(e)>0){var i=Number(e);r=function(){var e=this.parentNode;while(e&&i--)e=e.parentNode;if(!e||n==e)return!0;n=t[t.length]=e}}else r=function(){var e=this.parentNode;if(!e||n==e)return!0;n=t[t.length]=e};return this.iterate(r),sjs(t)},first:function(e){var t=new Array,n=null;return sjs.isFn(e)?n=function(n,r,i){var s=n.firstChild;s&&s.nodeType!=1&&(s=s.nextSibling),e.call(s,n,r,i),t.push(s)}:n=function(){var e=this.firstChild;e&&e.nodeType!=1&&(e=e.nextSibling),t.push(e)},this.iterate(n),sjs(t)},last:function(e){var t=new Array,n=null;return sjs.isFn(e)?n=function(n,r,i){var s=n.lastChild;s&&s.nodeType!=1&&(s=s.previousSibling),e.call(s,n,r,i),t.push(s)}:n=function(){var e=this.lastChild;e&&e.nodeType!=1&&(e=e.previousSibling),t.push(e)},this.iterate(n),sjs(t)},prev:function(e){var t=new Array,n=null;return sjs.isFn(e)?n=function(n,r,i){var s=this.previousSibling;s&&s.nodeType!=1&&(s=s.previousSibling),e.call(s,n,r,i),t.push(s)}:n=function(){var e=this.previousSibling;e&&e.nodeType!=1&&(e=e.previousSibling),t.push(e)},this.iterate(n),sjs(t)},next:function(e){var t=new Array,n=null;return sjs.isFn(e)?n=function(n,r,i){var s=this.nextSibling;s&&s.nodeType!=1&&(s=s.nextSibling),e.call(s,n,r,i),t.push(s)}:n=function(){var e=this.nextSibling;e&&e.nodeType!=1&&(e=e.nextSibling),t.push(e)},this.iterate(n),sjs(t)},nth:function(e){return e=="last"?e=this.length-1:e=="first"&&(e=0),sjs(this[e])},remove:function(){return this.iterate(function(){this.parentNode&&this.parentNode.removeChild(this)})},find:function(e){var t=new Array;return this.iterate(function(){t.push(sjs.querySelector(e,this))}),sjs(t.concat.apply([],t))},insertAfter:function(e){return e.constructor==String?e=sjs(e)[0]:e.sjs&&(e=e[0]),this.iterate(function(){sjs.after(this,e)})},insertBefore:function(e){return e.constructor==String?e=sjs(e)[0]:e.sjs&&(e=e[0]),this.iterate(function(){sjs.before(this,e)})},appendTo:function(e){return e.sjs||(e=sjs(e)),this.iterate(function(){e.append(this)})},append:function(e){return typeof e=="string"?e=sjs(e)[0]:e&&e.sjs&&(e=e[0]),this.iterate(function(){this.appendChild(e)})},prepend:function(e){return typeof e=="string"?e=sjs(e)[0]:e&&e.sjs&&(e=e[0]),this.iterate(function(){var t=sjs(this).first().item(0);t?sjs.before(e,t):this.appendChild(e)})},getSize:function(e){var t=sjs.getSize(this[0]);return t[e]||t},unselectable:function(){return this.iterate(function(){sjs.event.unselect(this)})},selectable:function(){return this.iterate(function(){sjs.event.select(this)})},show:function(e){return this.iterate(function(){this.style.display=e?"block":"",this.style.visibility="visible"})},hide:function(){return this.iterate(function(){this.style.display="none",this.style.visibility="hidden"})},toogleDisplay:function(e){return this.iterate(function(){this.style.display=="none"||this.style.visibility=="hidden"?(this.style.display=e?"block":"",this.style.visibility="visible"):(this.style.display="none",this.style.visibility="hidden")})},data:function(e,t){return typeof t=="undefined"?this[0].__sjsData&&this[0].__sjsData[e]:this.iterate(function(){this.__sjsData||(this.__sjsData={}),this.__sjsData[e]=t})},resetStyle:function(){return this.iterate(function(){this.style&&(this.style.cssText="")})},copyStyle:function(e){return e.sjs&&(e=e[0]),!e||!e.style?this:this.iterate(function(){this.style&&(this.style.cssText=e.style.cssText)})}},sjs.prototype.count=sjs.prototype.valueOf,sjs.extend=function(){var e=arguments[0],t=1,n,r;arguments.length==1&&(e=this,t=0);while(n=arguments[t++])for(r in n)e[r]=n[r];return e},sjs.extend({sjs:"1.1.2",count:0,readyFn:[],ui:{},globals:{},$empty:function(){},isActive:!1,pathToBlankGif:"/tmpl/img/blank.gif",wrapper:document.createElement("div"),exp:{BeginSpace:new RegExp(/^\s+/),EndSpace:new RegExp(/\s+$/),SpaceGlobal:new RegExp(/\s+/g),AsciiLetter:new RegExp(/[a-z]/),Quotes:new RegExp(/"[^\\"]*(?:\\.[^"\\]*)*"/)},escape:function(e){return escape(e).replace(new RegExp("\\+","g"),"%2B")},assignErrorHandler:function(){sjs.event.level3.add("error",function(e,t,n){alert("Call by file: "+t+"\nString: "+n+"\nError: "+e)},!1)},objectInfo:function(e,t,n){var r,i="";try{for(r in e){if(n&&!e.hasOwnProperty(r))continue;i+='<div style="color:red;">'+r+": ";if(typeof e[r]=="object"&&t){i+='{<div style="margin-left:20px;">'+sjs.objectInfo(e[r],t,n)+"</div>}</div>";continue}i+='<b style="font-size:16px; color:blue;">'+(sjs.htmlChars(e[r]+"")||e[r])+"</b></div>"}}catch(s){alert(s.message)}return i},print:function(e,t,n){var r=window.open("","__object_","width=800,height=800,top=150,left=200,scrollbars=1,resizable=1");r.document.write("<html><head><title>Object information</title></head><body>"),r.document.write("<p style='font-size:24px;'>Properties of object</p>"+sjs.objectInfo(e,t,n)+"</body></html>"),sjs.browser.mozilla&&r.stop()},toConsole:function(e,t,n,r,i,s){var o=document.getElementById(t||"console");if(typeof e=="object"||s)e=sjs.objectInfo(e,r,i);n?o.innerHTML+=e:o.innerHTML=e},newError:function(e){window.Error?(new Error(1,"test")).description=="test"?sjs.newError=function(e){throw new Error(1,e)}:sjs.newError=function(e){throw new Error(e)}:sjs.newError=function(e){throw e},sjs.newError(e)},plugin:function(e){var t=function(){return this.__construct?this.__construct.apply(this,arguments):this};return t.prototype=e,t},ready:function(e){if(sjs.isFn(e))sjs.readyFn.push(e);else{var t=sjs.readyFn.length;while(t--)sjs.readyFn[t].call(document);sjs.isActive=!0,sjs.readyFn=null;try{window.onload==this.ready&&sjs.event.attach(window,"onload",null),document.removeEventListener("DOMContentLoaded",sjs.ready,!1)}catch(n){}this.ready=function(e){e.apply(document,arguments)}}},cleanUp:function(){sjs.event.removeAll();var e=null,t=null;try{for(var n in sjs.globals){e=sjs.globals[n];for(t in e)e[t].__destruct();delete sjs.globals[n]}}catch(r){}e=t=n=sjs.globals=null},is_mail:function(e){return/^[\w\d_\.\-]+@[\w\d_\.\-]+(?:\.[\w\d]+)+$/i.test(sjs.trim(e))},is_date:function(e){return/^\d{1,2}([.\/\\-]|\s+)\d{1,2}\1\d{2,4}$/i.test(e.trim())},split:function(e,t){var n=[],r=0,i,s;while((i=e.search(t))+1)s=e.substr(r,i),e=e.substr(i+1),n.push(s),r=i-s.length;return n.push(e),n},indexOf:function(e,t){var n=0,r=e.length;while(n!=r&&e[n]!=t)n++;return n==e.length&&-1||n},lastIndexOf:function(e,t){var n=e.length;while(n--&&e[n]!=t);return n},in_array:function(e,t){return sjs.indexOf(e,t)!=-1},unique:function(e){var t=new Array;return sjs.each(e,function(e,n){t.in_array(e)||(t[t.length]=e)}),t},toList:function(e){var t=new Array,n=e.length;while(n--)t[n]=e[n];return t},setFilters:function(e,t,n,r){var i=r.filt,s=!0,t=i.length,o=sjs.filters,u;while(t--&&s)u=i[t],s=o[u[0]](e,t,n,u[1],u);return i=u=o=null,!s},filter:function(e,t){var n=t.slice.call(arguments,2),r=e.length,i=n.length,s,o,u,a;for(a=0;a<r;a++){u=e[a],o=i,s=!0;while(o--&&(s=n[o](u,a,e,n[o])));s&&t.push(u)}return t},parseSelector:function(e){var t=sjs.selReg("(?::)"),n=sjs.selReg("\\[.*\\]"),r=new RegExp(/([^#.]+)?(?:([#.])(.+))?/i),i=new RegExp(/^\[?\s*([^=]+)\s*(?:=(?:\s*["']?)(.+))?/i),s=new RegExp(/^([^\(]+)(?:\((\s*['"]?)(.+)\2\))?/i),o=sjs.selReg("(?:[\"']?\\s*\\])"),u,a,f,l,c=new Array,h;e=e.trim(),l=e.charAt(0),u=(((l=="["||l==":")&&"*"||"")+e).split(t),a=u.shift(),f=a.match(n),a=a.split(n)[0].match(r),a.shift(),l=a,f=f&&f[0]&&f[0].split(o)||[],h=u.length;while(h--)a=s.exec(u[h]),e=a[3],a[1].indexOf("nth")!=-1?e=e=="odd"&&[2,1]||e=="even"&&[2,0]||e.indexOf("+")==-1&&[Infinity,parseInt(e)]||[parseInt(e),Number(e.split("+")[1]||0)]:a[1]=="not"&&(e=sjs.parseSelector(a[3])),c[c.length]=[a[1],e];h=f.length;while(h--)a=i.exec(f[h]),a&&a[1]&&(a.shift(),a[1]=a[1]&&new RegExp(a[1]),c[c.length]=["attr",a]);return[l,c]},querySelector:function(e,t){e=e.split(sjs.selReg("(?:\\s*,\\s*)"));var n=sjs.selReg("(?:(?:>|\\+|~|\\s(?![+>~]))\\s*)"),r=sjs.selReg("(?::)"),i=sjs.selReg("\\[.*\\]"),s=sjs.selReg("(?:[\"']?\\s*\\])"),o=new RegExp(/([^#.]+)?(?:([#.])(.+))?/i),u=new Array,a=new RegExp(/^\[?\s*([^=]+)\s*(?:=(?:\s*["']?)(.+))?/i),f=new RegExp(/^([^\(]+)(?:\((\s*['"]?)(.+)\2\))?/i),l,c=[t||document],h=e.length,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k=[],L=function(e,t,n,r){var i=r.filt,s=!0,t=i.length,o=sjs.filters,u;while(t--&&s)u=i[t],s=o[u[0]](e,t,n,u[1],u);return i=u=o=null,s};while(h--){v=e[h];if(C=v=="body"&&document.body||(v==":root"||v=="html")&&document.documentElement){u[u.length]=C;continue}m=v.match(n)||[],g=v.split(n)||[],m.unshift(" "),p=-1,l=c,n=g.length;while(++p<n){v=g[p].trim(),C=v.charAt(0),y=(((C=="["||C==":")&&"*"||"")+v).split(r),E=y.shift(),w=E.match(i),E=E.split(i)[0].match(o),S=E[2]||"tag",x=E[3],T=E[1]||"*",N=[],b=[0,[]],w=w&&w[0]&&w[0].split(s)||[],d=y.length;while(d--){E=f.exec(y[d]),v=E[3];if(E[1].indexOf("nth")!=-1)v=v=="odd"&&[2,1]||v=="even"&&[2,0]||v.indexOf("+")==-1&&[Infinity,parseInt(v)]||[parseInt(v),Number(v.split("+")[1]||0)];else if(E[1]=="not"||E[1]=="has")v=sjs.parseSelector(E[3]);N.push([E[1],v])}d=w.length;while(d--)E=a.exec(w[d]),E&&E[1]&&(E.shift(),E[1]=E[1]&&new RegExp(E[1]),N.push(["attr",E]));S=sjs.selectors[m[p].trim()][S](x,T,b),N.length&&(L.filt=N,b.push(L)),v=l.length;for(d=0;d<v;d++)S(l[d],b,T,x,l[d-1]);l=b[1],d=l.length;while(d--)l[d].__sjs__=null;L.filt=w=E=S=C=b=N=null}u=u.concat(l)}return c=e=v=r=n=f=a=o=s=i=null,u},selReg:function(e){return new RegExp(e+"(?!(?:(?:[^\\[\\(]*|[\"'\\(\\[]?[^\"']*[\"'\\)\\]]|[^\"'\\(\\[]*)(?![\\[\\(]))(?:[\\[\\]\"'\\\\\\[\\\\\\]\\\\\\(\\\\\\)]{1}))","gi")},selectors:{"":{"#":function(e,t,n){return function(e,t,n,r){return t[0]=[document.getElementById(r)],t[0][0]&&!t[0][0].__sjs__&&(t[0][0].__sjs__=1)&&sjs.filter.apply(sjs,t)}},".":function(e,t,n){return e=new String(" "+e+" "),t&&t!="*"?(n.push(function(t){return!t.__sjs__&&(" "+t.className+" ").indexOf(e)!=-1&&(t.__sjs__=1)}),function(e,t,n){return t[0]=e.getElementsByTagName(n),sjs.filter.apply(sjs,t)}):function(e,t,n,r){return t[0]=sjs.getElementsByClassName(e,r),sjs.filter.apply(sjs,t)}},tag:function(e,t,n){return function(e,t,n){return t[0]=e.getElementsByTagName(n),sjs.filter.apply(sjs,t)}}},">":{"#":function(e,t,n){return n.push(function(t){return!t.__sjs__&&t.id==e&&t.parentNode.isMyParent&&(t.__sjs__=1)}),this.call},".":function(e,t,n){return e=new String(" "+e+" "),n.push(function(t){return!t.__sjs__&&t.parentNode.isMyParent&&(" "+t.className+" ").indexOf(e)!=-1&&(t.__sjs__=1)}),this.call},tag:function(e,t,n){return n.push(function(e){return!e.__sjs__&&e.parentNode.isMyParent&&(e.__sjs__=1)}),this.call},call:function(e,t,n){t[0]=e.getElementsByTagName(n),e.isMyParent=!0;var r=sjs.filter.apply(sjs,t);return e.isMyParent=null,r}},"+":{"#":function(e,t,n){return n.push(function(t){return!t.__sjs__&&t.id==e&&(t.__sjs__=1)}),this.call},".":function(e,t,n){return e=new String(" "+e+" "),n.push(function(t){return!t.__sjs__&&(" "+t.className+" ").indexOf(e)!=-1&&(t.__sjs__=1)}),this.call},tag:function(e,t,n){return n.push(function(e){return!e.__sjs__&&sjs.nodeName(e,t)&&(e.__sjs__=1)}),this.call},call:function(e,t){while((e=e.nextSibling)&&e.nodeType!=1);return t[0]=e&&[e]||[],sjs.filter.apply(sjs,t)}},"~":{call:function(e,t,n,r,i){if(e.parentNode!=(i&&i.parentNode)){var s=e.nextSibling,o=[];do s&&s.nodeType==1&&(o[o.length]=s);while(s=s&&s.nextSibling);return t[0]=o,o=null,sjs.filter.apply(sjs,t)}}}},filters:{attr:function(e,t,n,r){return r[1]?r[1].test(sjs.getAttrNode(e,r[0])||""):sjs.hasAttr(e,r[0])},_attr:{"=~":function(e,t,n){return t=sjs.getAttrNode(e,t),t&&n.test(t)},"=":function(e,t,n){return t=sjs.getAttrNode(e,t),t==n},"^=":function(e,t,n){return t=sjs.getAttrNode(e,t),t&&!t.indexOf(n)},"$=":function(e,t,n){return t=sjs.getAttrNode(e,t),t&&t.indexOf(n)==t.length-n.length},"*=":function(e,t,n){return t=sjs.getAttrNode(e,t),t&&t.indexOf(n)+1},"|=":function(e,t,n){return t=sjs.getAttrNode(e,t),t&&("-"+t+"-").indexOf(n)+1},"~=":function(e,t,n){return t=sjs.getAttrNode(e,t),t&&(" "+t+" ").indexOf(n)+1},has:function(e,t){return sjs.hasAttr(e,t)}},enabled:function(e){return e.disabled===!1&&e.type!=="hidden"},disabled:function(e){return e.disabled===!0},checked:function(e){return e.checked===!0},selected:function(e){return e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){return"text"===e.type},radio:function(e){return"radio"===e.type},checkbox:function(e){return"checkbox"===e.type},file:function(e){return"file"===e.type},password:function(e){return"password"===e.type},submit:function(e){return"submit"===e.type},image:function(e){return"image"===e.type},reset:function(e){return"reset"===e.type},button:function(e){return"button"===e.type||sjs.nodeName(e,"button")},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},root:function(e){return e.nodeName.toLowerCase()=="html"},visible:function(e){return e.offsetWidth&&e.offsetHeight},hidden:function(e){return!e.offsetWidth||!e.offsetHeight},contains:function(e,t,n,r){return sjs.getText(e).indexOf(r)+1},animated:function(e){var t=sjs.globals.anime&&sjs.globals.anime[e.sjsEventId];if(!t)return!1;for(var n in t)if(t[n].timer!=-2)return!0;return!1},has:function(e,t,n,r){var i=sjs.all(e),s=1,o=i.length,u=sjs.filters.not;while(o--&&s)s=u(i[o],o,i,r);return!s},not:function(e,t,n,r){var s=r[0],o=s[1],u,a,f=o=="."&&(" "+e.className+" ").indexOf(s[2])+1||o=="#"&&e.id==s[2]||!0;o=s[0],o!="*"&&(f=f&&e.nodeName.toLowerCase()==o),o=sjs.filters._attr,s=r[1],i=s.length,a=Boolean.xor;while(f&&i--)u=s[i],f=a(o[u[0]](e,u[1],u[2]),u[3]);o=sjs.filters,s=r[2],i=s.length,a=null;while(f&&i--)u=s[i],f=o[u[0]](e,t,n,u[1]);return!f},"nth-child":function(e,t,n,r){var i=e.parentNode.firstChild,s=e.nodeIndex||0,o=r[0],u=r[1];if(s)return e.nodeIndex=null,u=s-u,!(u%o)&&u/o>=0;do if(i.nodeType==1&&(i.nodeIndex=++s)&&i===e&&((s-u)/o<0||(s-u)%o))return i.nodeIndex=null,0;while(i=i.nextSibling);return!0},"nth-last-child":function(e,t,n,r){var i=e.parentNode.lastChild,s=e.nodeLastIndex||0,o=r[0],u=r[1];if(s)return e.nodeLastIndex=null,u=s-u,!(u%o)&&u/o>=0;do if(i.nodeType==1&&(i.nodeLastIndex=++s)&&i===e&&((s-u)/o<0||(s-u)%o))return i.nodeLastIndex=null,0;while(i=i.previousSibling);return!0},"first-child":function(e){while((e=e.previousSibling)&&e.nodeType!=1);return!e},"last-child":function(e){while((e=e.nextSibling)&&e.nodeType!=1);return!e},"only-child":function(e){return sjs.filters["first-child"](e)&&sjs.filters["last-child"](e)},"nth-of-type":function(e,t,n,r){var i=e.parentNode.getElementsByTagName(e.nodeName),s=r[0],o=r[1],u=e.typeIndex||0,a,f=0;if(u)return e.typeIndex=null,o=u-o,!(o%s)&&o/s>=0;e.parentNode.__sjsIsParent__=1,a=i[u];do if(a.parentNode.__sjsIsParent__&&(a.typeIndex=++f)&&a===e&&((f-o)/s<0||(f-o)%s))return a.typeIndex=null,0;while(a=i[++u]);return e.parentNode.__sjsIsParent__=null,!0},"nth-last-of-type":function(e,t,n,r){var i=e.parentNode.getElementsByTagName(e.nodeName),s=r[0],o=r[1],u=e.typeLastIndex||0,a,f=0;if(u)return e.typeIndex=null,o=u-o,!(o%s)&&o/s>=0;e.parentNode.__sjsIsParent__=1,a=i[u=i.length-1];do if(a.parentNode.__sjsIsParent__&&(a.typeLastIndex=++f)&&a===e&&((f-o)/s<0||(f-o)%s))return a.typeLastIndex=null,0;while(a=i[--u]);return e.parentNode.__sjsIsParent__=null,!0},"first-of-type":function(e){return e.typeIndex==1||e.parentNode.getElementsByTagName(e.nodeName)[0]==e},"last-of-type":function(e,t,n){return e.typeLastIndex==1||sjs.filters["nth-last-of-type"](e,t,n,[Infinity,1])},"only-of-type":function(e){return e.parentNode.getElementsByTagName(e.nodeName).length==1},first:function(e,t){return!t},last:function(e,t,n){return n.length-t==1},even:function(e,t){return!(t%2)},odd:function(e,t){return t%2},lt:function(e,t,n,r){return t<r},gt:function(e,t,n,r){return t>r},nth:function(e,t,n,r){return r==t}},cookie:{isset:function(e){return document.cookie.indexOf(escape(e)+"=")!=-1},remove:function(e){e=escape(e),document.cookie=e+"=0; expires=Fri, 31 Dec 1999 23:59:59 GMT; "},get:function(e){var t,n=null;return e=escape(e),t=document.cookie.indexOf(e+"=")+1,t&&(n=document.cookie.substr(t+e.length),t=n.indexOf(";"),t+1&&(n=n.substr(0,t))),n&&unescape(n)},set:function(e,t,n,r,i){var s;e=escape(e),t=escape(t),t=e+"="+t+"; ";if(n=parseInt(n))s=new Date,s.setDate(s.getTime()+n*86400),t+="expires="+s.toUTCString()+"; ";r&&(t+="path="+r+"; "),i&&(t+="secure="+i+"; "),document.cookie=t}},className:{get:function(e){return e.className&&e.className.trim().space().split(" ")},set:function(e,t){if(t){var n=sjs.trim(e.className),r=sjs.trim(t);n?e.className=n+" "+r:e.className=r}},remove:function(e,t){var n=e.className.split(" "),r=sjs.indexOf(n,t);return r+1&&(n[r]="",e.className=n.join(" ")),r!=-1},has:function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")!=-1}},event:{fire:function(e,t){return document.createEventObject?this.fire=function(e,t){var n=document.createEventObject();return e.fireEvent("on"+t,n)}:document.createEvent?this.fire=function(e,t){var n=document.createEvent("HTMLEvents");return n.initEvent(t,!0,!0),!e.dispatchEvent(n)}:sjs.newError("can't find function fireEvent(obj,type)"),this.fire(e,t)},attach:function(e,t,n){e[t]=n},remove:function(e){delete this[e]},level3:{add:function(e,t,n,r){return e.addEventListener?this.add=function(e,t,n,r){e.addEventListener(t,n,r)}:e.attachEvent?this.add=function(e,t,n,r){e.attachEvent("on"+t,n)}:sjs.newError("can't find function level3.add (event,handler,bubble)"),this.add(e,t,n,r)}},add:function(e,t,n){this[n]||(this[n]={}),this[n][e]||(this[n][e]=new Array),this[n][e].push(t)},call:function(e){var e=e||window.event,t=sjs.event[this.sjsEventId][e.type];for(var n=0,r=t.length;n<r;n++)t[n].call(this,e);t=e=null},removeAll:function(){for(var e in this){if(isNaN(Number(e)))continue;this[e]=null,delete this[e]}},target:function(e,t){return typeof e.fromElement!=undefined?this.target=function(e,t){return e[t+"Element"]}:typeof e.relatedTarget!=undefined?this.target=function(e,t){return e.relatedTarget}:sjs.newError('can\'t find function target (event,["from" | "to" (for IE)])'),this.target(e,t)},caller:function(e){return e.srcElement?this.caller=function(e){return e.srcElement}:e.target?this.caller=function(e){return e.target}:sjs.newError("can't find function caller (event)"),this.caller(e)},key:function(e){return typeof e.keyCode=="number"?this.key=function(e){return{code:e.keyCode,shift:e.shiftKey,ctrl:e.ctrlKey,alt:e.altKey}}:typeof e.which=="number"?this.key=function(e){return{code:e.which,shift:e.shiftKey,ctrl:e.ctrlKey,alt:e.altKey}}:sjs.newError("can't find function key (event)"),this.key(e)},xy:function(e){return e.pageX&&e.pageY?this.xy=function(e){return{x:e.pageX,y:e.pageY}}:e.clientX&&e.clientY?this.xy=function(e){var t=document.documentElement,n=document.body;return{x:e.clientX+(t.scrollLeft||n.scrollLeft),y:e.clientY+(t.scrollTop||n.scrollTop)}}:sjs.newError("can't find function xy (event)"),this.xy(e)},offsetXY:function(e){return e.layerX&&e.layerY?this.offsetXY=function(e){return{x:e.layerX,y:e.layerY}}:e.offsetX&&e.offsetY?this.offsetXY=function(e){return{x:e.offsetX,y:e.offsetY}}:sjs.newError("can't find function offsetXY (event)"),this.offsetXY(e)},attachWheel:function(e,t){return e.addEventListener?this.attachWheel=function(e,t){return e.addEventListener("DOMMouseScroll",t,!1),e.addEventListener("mousewheel",t,!1),"DOMMouseScroll"}:this.attachWheel=function(e,t){return e.onmousewheel=t,"mousewheel"
},this.attachWheel(e,t)},unselect:function(e){sjs.browser.msie?(this.unselect=function(e){e.onselectstart=function(){return!1}},this.select=function(e){e.onselectstart=null}):sjs.browser.mozilla?(this.unselect=function(e){e.style.MozUserSelect="none"},this.select=function(e){e.style.MozUserSelect=""}):sjs.browser.safari?(this.unselect=function(e){e.style["-webkit-user-select"]="none"},this.select=function(e){e.style["-webkit-user-select"]=""}):sjs.browser.opera?(this.unselect=function(e){e.style["-o-user-select"]="none"},this.select=function(e){e.style["-o-user-select"]=""}):this.unselect=this.select=sjs.$empty,this.unselect(e)},preventDefault:function(e){return e.stopPropagation?this.preventDefault=function(e){return e.preventDefault()}:this.preventDefault=function(e){return e.returnValue=!1},this.preventDefault(e)},stopPropagation:function(e){return e.stopPropagation?this.stopPropagation=function(e){return e.stopPropagation()}:this.stopPropagation=function(e){return e.cancelBubble=!0},this.stopPropagation(e)},wheel:function(e){return e.wheelDelta?this.wheel=function(e){return e.wheelDelta/120}:e.detail?this.wheel=function(e){return-e.detail/3}:sjs.newError("can't find function wheel(event)"),this.wheel(e)}},escape:function(e){return escape(e).replace(new RegExp("\\+","g"),"%2B")},toQuery:function(e){return sjs.toArray(e,1).join("&")},toArray:function(e,t){var n=[],r,i,s=0,o={};return sjs.iterate(e.elements,function(){r=this.name,i=this.value;if((this.type=="checkbox"||this.type=="radio")&&!this.checked)return!0;/select/i.test(this.type)&&(i=this.options[this.selectedIndex].value),i=sjs.escape(i),n.push(r+"="+i),o[r]=i}),t?n:o},each:function(e,t){if(e.length==undefined)for(var n in e)t.call(e[n],e[n],n,e);else sjs.forEach(e,t);return e},forEach:function(e,t){for(var n=0,r=e.length;n<r&&t.call(e[n],e[n],n,e)!==!1;n++);return e},iterate:function(e,t){for(var n=0,r=e.length;n<r;n++)t.call(e[n],e[n],n,e);return e},isFn:function(e){return e&&e.constructor==Function},isXMLdoc:function(e){return e.tagName&&e.ownerDocument&&!e.ownerDocument.body},nodeName:function(e,t){return e&&e.nodeName&&e.nodeName.toUpperCase()==t.toUpperCase()},trim:function(e){return e.replace(sjs.exp.BeginSpace,"").replace(sjs.exp.EndSpace,"")},space:function(e){return sjs.trim(e.replace(sjs.exp.More2SpaceGlobal," "))},htmlChars:function(e){var t=sjs.wrapper,n=document.createTextNode(e);return t.appendChild(n),e=t.innerHTML,t.innerHTML="",e},detectStyle:function(e){return e?e.replace(/-(\w)/i,function(e,t){return t.toUpperCase()}):!1},before:function(e,t){t.parentNode.insertBefore(e,t)},after:function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},swap:function(e,t){return e.swapNode?this.swap=function(e,t){return e.swapNode(t)}:this.swap=function(e,t){var n=sjs.newText("");return sjs.before(n,e),sjs.before(e,t),n.parentNode.replaceChild(t,n),n=null,e},this.swap(e,t)},newTag:function(e){return document.createElement(e)},newText:function(e){return document.createTextNode(e)},setOpacity:function(e,t){if(!e)return!1;t=t||0,typeof e.style.opacity=="string"?sjs.setOpacity=function(e,t){e.style.opacity=t}:typeof e.style.MozOpacity=="string"?sjs.setOpacity=function(e,t){e.style.MozOpacity=t}:typeof e.style.KhtmlOpacity=="string"?sjs.setOpacity=function(e,t){e.style.KhtmlOpacity=t}:e.filters&&sjs.browser.msie?sjs.setOpacity=function(e,t){t*=100;var n=e.filters["DXImageTransform.Microsoft.Alpha"]||e.filters.alpha;if(n)try{n.opacity=t}catch(r){e.style.filter=e.style.filter.replace(/alpha\([^\)]*\)/i,"")+"alpha(opacity="+t+")"}else e.style.filter+="progid:DXImageTransform.Microsoft.Alpha(opacity="+t+")"}:sjs.newError("cant' find function setOpacity(domObject,opacity)"),sjs.setOpacity(e,t)},css:function(e,t){return e.currentStyle?this.css=function(e,t){return e.currentStyle[sjs.detectStyle(t)]}:document.defaultView&&document.defaultView.getComputedStyle?this.css=function(e,t){var n=document.defaultView.getComputedStyle(e,null);return n.getPropertyValue(t)}:sjs.newError("cant' find function css(domObject,rule)"),this.css(e,t)},getPosition:function(e){return e.getBoundingClientRect?this.getPosition=function(e){var t=document.documentElement,n=document.body,r=t.scrollTop||n.scrollTop+t.clientTop||n.clientTop,i=t.scrollLeft||n.scrollLeft+t.clientLeft||n.clientLeft;return t=null,n=e.getBoundingClientRect(),{left:parseInt(n.left+i),top:parseInt(n.top+r)}}:this.getPosition=function(e){var t=0,n=0,r=e.style,i=!1,s=e;if(sjs.css(e,"display")=="none"){var o=r.visibility,u=r.position;i=!0,r.visibility="hidden",r.display="block",r.position="absolute"}while(s)t+=s.offsetLeft+parseInt(sjs.css(s,"border-left-width")||0)*!sjs.browser.opera,n+=s.offsetTop+parseInt(sjs.css(s,"border-top-width")||0)*!sjs.browser.opera,s=s.offsetParent;while(!sjs.nodeName(e,"body"))t+=e.scrollLeft||0,n+=e.scrollTop||0,e=e.parentNode;return i&&(r.display="none",r.position=u,r.visibility=o),s=e=r=null,{left:t,top:n}},this.getPosition(e)},getSimplePosition:function(e){var t=0,n=0;while(e)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{left:t,top:n}},isElementPosition:function(e,t){if(!e)return!1;var n=sjs.getSimplePosition(e),r=n.top,i=n.left,s=e.offsetWidth,o=e.offsetHeight;return i<t.x&&i+s>t.x&&r<t.y&&r+o>t.y},isElementPositionRelative:function(e,t){if(!e)return!1;var n=e.offsetTop,r=e.offsetLeft,i=e.offsetWidth,s=e.offsetHeight;return r<t.x&&r+i>t.x&&n<t.y&&n+s>t.y},fixPNG:function(e,t){sjs.browser.msie&&sjs.browser.version<="6.0"?this.fixPNG=function(e,t){var n;sjs.nodeName(e,"img")&&/\.png$/i.test(e.src)?(n=e.src,e.src=t||"blank.gif"):(n=sjs.css(e,"backgroundImage").match(/url\("(.+\.png)"\)/i),n&&(n=n[1],e.runtimeStyle.backgroundImage="none")),n&&(e.runtimeStyle.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+n+"',sizingMethod='scale')")}:this.fixPNG=sjs.$empty,sjs.fixPNG(e,t)},setAttrNode:function(e,t,n){try{e.attributes[t].nodeValue=n}catch(r){sjs.setAttr(e,t,n)}return!0},getAttrNode:function(e,t){return e.attributes&&e.attributes[t]&&e.attributes[t].nodeValue},getAttr:function(e,t){return e.getAttribute(t)},setAttr:function(e,t,n){return e.setAttribute(t,n)},hasAttr:function(e,t){return e.hasAttribute?sjs.hasAttr=function(e,t){return e.hasAttribute(t)}:sjs.hasAttr=function(e,t){return e.attributes&&e.attributes[t]&&e.attributes[t].specified},sjs.hasAttr(e,t)},all:function(e){return e.all?sjs.all=function(e){return e.all}:sjs.all=function(e){return e.getElementsByTagName("*")},sjs.all(e)},getElementsByClassName:function(e,t){return e.getElementsByClassName?this.getElementsByClassName=function(e,t){return e.getElementsByClassName(t)}:this.getElementsByClassName=function(e,t){var n=sjs.all(e),r=n.length,i=-1,s=[];t=" "+t+" ";while(++i<r)(" "+n[i].className+" ").indexOf(t)+1&&(s[s.length]=n[i]);return s},this.getElementsByClassName(e,t)},addBookMark:function(e,t,n){if(typeof window.sidebar=="object"&&sjs.isFn(window.sidebar.addPanel))this.addBookMark=function(e,t){e||(e=location.href),t||(t=document.title),window.sidebar.addPanel(t,e,"")};else if(typeof window.external=="object")this.addBookMark=function(e,t){e||(e=location.href),t||(t=document.title),window.external.AddFavorite(e,t)};else{if(!(sjs.browser.opera&&sjs.browser.version>="7.0"))return!1;this.addBookMark=function(e,t,n){e||(e=location.href),t||(t=document.title),sjs.setAttr(n,"rel","sidebar"),sjs.setAttr(n,"href",e),sjs.setAttr(n,"title",t)}}this.addBookMark(e,t,n)},selectText:function(e,t,n){return e.setSelectionRange?sjs.selectText=function(e,t,n){return e.setSelectionRange(t,n)}:e.createTextRange?sjs.selectText=function(e,t,n){var r=e.createTextRange();return r.collapse(!0),r.moveStart("character",t),r.moveEnd("character",Math.abs(n-t)),r.select()}:sjs.selectText=sjs.$empty,sjs.selectText(e,t,n)},setText:function(e,t){typeof e.textContent=="string"?sjs.setText=function(e,t){e.textContent=t}:typeof e.innerText=="string"?sjs.setText=function(e,t){e.innerText=t}:sjs.newError("can't find function: setText(domObject,textContent)"),sjs.setText(e,t)},getText:function(e){return typeof e.textContent=="string"?sjs.getText=function(e){return e.textContent}:typeof e.innerText=="string"?sjs.getText=function(e){return e.innerText}:sjs.newError("can't find function: getText(domObject)"),sjs.getText(e)},makeHTML:function(e,t){var n=sjs.wrapper,r,i;n.innerHTML=e;if(t&&t.nodeName){i=n.childNodes,r=0;while(i[r])t.appendChild(i[r++]);i=null}return n.childNodes},getBrowserWindowScrolls:function(){var e={top:0,left:0};return self&&self.pageYOffset?(e.left=self.pageXOffset,e.top=self.pageYOffset):document.documentElement&&document.documentElement.scrollTop?(e.left=document.documentElement.scrollLeft,e.top=document.documentElement.scrollTop):document.body&&(e.left=document.body.scrollLeft,e.top=document.body.scrollTop),e},getBrowserWindowSize:function(){var e={width:0,height:0};return self&&self.innerHeight?(e.width=self.innerWidth,e.height=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(e.width=document.documentElement.clientWidth,e.height=document.documentElement.clientHeight):document.body&&(e.width=document.body.clientWidth,e.height=document.body.clientHeight),e},getSize:function(e){var t=[parseInt(sjs.css(e,"margin-top"))||0,parseInt(sjs.css(e,"margin-right"))||0,parseInt(sjs.css(e,"margin-bottom"))||0,parseInt(sjs.css(e,"margin-left"))||0],n=[parseInt(sjs.css(e,"padding-top"))||0,parseInt(sjs.css(e,"padding-right"))||0,parseInt(sjs.css(e,"padding-bottom"))||0,parseInt(sjs.css(e,"padding-left"))||0],r=[parseInt(sjs.css(e,"border-top-width"))||0,parseInt(sjs.css(e,"border-right-width"))||0,parseInt(sjs.css(e,"border-bottom-width"))||0,parseInt(sjs.css(e,"border-left-width"))||0];return{margin:t,padding:n,border:r,height:sjs(e).height(),width:sjs(e).width()}},capitalize:function(e){var t=e.charAt(0);return t=t.toUpperCase(),e=(e.substr(1)||"").toLowerCase(),t+e},pathinfo:function(e){var t={},n=e.lastIndexOf("/");return n==-1?(t.basename=e,t.dirname=""):(t.basename=e.substr(n+1),t.dirname=e.substr(0,n)),n=t.basename.lastIndexOf("."),n==-1?(t.filename=t.basename,t.extension=""):(t.filename=t.basename.substr(0,n),t.extension=t.basename.substr(n+1)),t},createChunk:function(e){var t=document.createDocumentFragment();for(var n=0,r=e.length;n<r;n++)t.appendChild(e[n]);return t}}),sjs.when=function(e,t,n){return e.resolve?e.resolve(t).reject(n):t.call(e,e)},sjs.promise=function(){this.callbacks={ok:[],err:[]},this.state=null},sjs.promise.prototype={_call:function(e,t){var n=this.callbacks[e],r=n.length;while(r--)n[r].call(this,t)},resolve:function(e){return sjs.isFn(e)?this.callbacks.ok.push(e):(this.state=!0,this._call("ok",e)),this},reject:function(e){return sjs.isFn(e)?this.callbacks.err.push(e):(this.state=!1,this._call("err",null)),this},isOk:function(){return this.state===!0},isErr:function(){return this.state===!1},isResolved:function(){return this.state!==null}},sjs.ScrollableContent=new sjs.plugin({__construct:function(e,t){t=t||{};var n=this;this.cfg={},this.page=t.page||1,this.cfg.gt=t.gt||3,this.cfg.data=t.data||{},this.cfg.url=t.url,this.loaded={},this.events={load:new sjs.promise,data:new sjs.promise},sjs(e).mousewheel(function(){(this.scrollHeight-this.scrollTop<=this.scrollHeight/n.cfg.gt||this.offsetHeight+this.scrollTop>=this.scrollHeight)&&n.load()})},load:function(e){var t=this,n=this.page;if(!e&&this.loaded[n])return!1;this.cfg.data.page=this.page,t.events.data.resolve(this.cfg.data),this.loaded[n]=!0,sjs.query(this.cfg.url,this.cfg.data,function(e,n){t.events.load.resolve({js:e,html:n,loader:t})},1)},on:function(e,t){return this.events[e].resolve(t),this},clearCache:function(){return this.loaded={},this}}),function(){var e=navigator.userAgent.toLowerCase(),t=e.indexOf("opera")!=-1,n=e.indexOf("webkit")!=-1;sjs.browser={lang:navigator.language||navigator.userLanguage,version:(e.match(/.+(?:rv|it|ra|ie|version|firefox)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:n,opera:t,msie:e.indexOf("msie")!=-1&&!t,mozilla:e.indexOf("mozilla")!=-1&&e.indexOf("compatible")+n==-1}}(),sjs.attrMap={$for:"htmlFor",$float:sjs.browser.msie?"styleFloat":"cssFloat",$pointer:sjs.browser.msie&&sjs.browser.version<="5.5"?"hand":"pointer"},sjs.support={svg:window.SVGPreserveAspectRatio&&window.SVGPreserveAspectRatio.SVG_PRESERVEASPECTRATIO_XMINYMIN==2,vml:sjs.browser.msie&&sjs.browser.version>="5.5"},["click","mousemove","mouseout","mouseover","mousedown","mouseup","contextmenu","dblclick","keydown","keypress","keyup","submit","focus","change","blur","reset","scroll"].iterate(function(e){sjs.prototype[e]=function(){return this.on(e).add.apply(this,arguments)}}),["#",".","tag"].iterate(function(e){sjs.selectors["~"][e]=sjs.selectors["+"][e]}),["push","sort","splice"].iterate(function(e){sjs.prototype[e]=this[e]}),sjs.event.level3.add(window,"unload",sjs.cleanUp,!1);if(sjs.browser.mozilla||sjs.browser.opera)document.addEventListener("DOMContentLoaded",sjs.ready,!1);else if(sjs.browser.msie){document.write('<script id="__ie_ready" defer="true" src="//:"></script>');var scr=document.getElementById("__ie_ready");scr&&(scr.onreadystatechange=function(){if(this.readyState!="complete")return;this.parentNode.removeChild(this),sjs.ready()}),scr=null}else if(sjs.browser.safari)var __safari_ready=setInterval(function(){if(document.readyState=="loaded"||document.readyState=="complete")clearInterval(__safari_ready),__safari_ready=null,sjs.ready()},10);else sjs.event.level3.add(window,"onload",sjs.ready);sjs.globals.drag={},sjs.startDrag=function(e,t){return sjs.event.unselect(document.documentElement),t=t||{},t._x=t._x||0,t._y=t._y||0,t.target=e,t.onMove&&!sjs.isFn(t.onMove)&&(t.onMove=!1),sjs.globals.drag[e.sjsEventId]=t,sjs(document).on("mousemove").add(sjs.ui.move[t.type],e.sjsEventId),t=null,e.sjsEventId},sjs.stopDrag=function(e,t){var n=sjs.globals.drag[t];return n?(sjs.event.select(document.documentElement),sjs.isFn(n.onDragEnd)&&n.onDragEnd.call(n.target,n,t,e),delete sjs.globals.drag[t],sjs(document).dettach("mousemove",sjs.ui.move[n.type]),n=n.target=null,!0):!1},sjs.stopDragAll=function(e){for(var t in sjs.globals.drag)sjs.stopDrag(e,t)},sjs.ui.move={"undefined":function(e,t){var n=sjs.event.xy(e),r=sjs.globals.drag[t];r.target.style.top=n.y-r._y+"px",r.target.style.left=n.x-r._x+"px",r.onMove&&r.onMove.call(r.target,n.x-r._x,n.y-r._y,r),sjs.event.preventDefault(e)},horizontal:function(e,t){var n=sjs.event.xy(e),r=sjs.globals.drag[t];r.target.style.left=n.x-r._x+"px",r.onMove&&r.onMove.call(r.target,n.x-r._x,null,r),sjs.event.preventDefault(e)},vertical:function(e,t){var n=sjs.event.xy(e),r=sjs.globals.drag[t];r.target.style.top=n.y-r._y+"px",r.onMove&&r.onMove.call(r.target,null,n.y-r._y,r),sjs.event.preventDefault(e)},grid:function(e,t){var n=sjs.event.xy(e),r=sjs.globals.drag[t],i=r.target,s=n.y-r._y,o=n.x-r._x,u=null,a=null,f=null;Math.abs(o-i.offsetLeft)>=r.gridX&&(f=o<i.offsetLeft?-r.gridX:r.gridX,i.style.left=i.offsetLeft+f+"px",u=i.offsetLeft+f),Math.abs(s-i.offsetTop)>=r.gridY&&(f=s<i.offsetTop?-r.gridY:r.gridY,i.style.top=i.offsetTop+f+"px",a=i.offsetTop+f),r.onMove&&r.onMove.call(r.target,u,a,r),sjs.event.preventDefault(e)},bounds:function(e,t){var n=sjs.event.xy(e),r=sjs.globals.drag[t],i=r.target,s=n.y-r._y,o=n.x-r._x;o<=r.left?o=r.left:o+i.offsetWidth>=r.right&&(o=r.right-i.offsetWidth),s<=r.top?s=r.top:s+i.offsetHeight>=r.bottom&&(s=r.bottom-i.offsetHeight),i.style.left=o+"px",i.style.top=s+"px",r.onMove&&r.onMove.call(r.target,o,s,r),sjs.event.preventDefault(e)},offsetBounds:function(e,t){var n=sjs.event.xy(e),r=sjs.globals.drag[t],i=r.target,s=n.y-r._y,o=n.x-r._x,u=i.parentNode;o<=r.left-u.offsetLeft?o=r.left-u.offsetLeft:o+i.offsetWidth>=r.right-u.offsetLeft&&(o=r.right-i.offsetWidth-u.offsetLeft),s<=r.top-u.offsetTop?s=r.top-u.offsetTop:s+i.offsetHeight>=r.bottom-u.offsetTop&&(s=r.bottom-i.offsetHeight-u.offsetTop),i.style.left=o+"px",i.style.top=s+"px",r.onMove&&r.onMove.call(r.target,o,s,r),sjs.event.preventDefault(e)},parentOffset:function(e,t){var n=sjs.event.xy(e),r=sjs.globals.drag[t],i=r.target,s=n.y-r._y,o=n.x-r._x,u=i.parentNode;o<=0?o=0:o+i.offsetWidth>=u.offsetWidth&&(o=u.offsetWidth-i.offsetWidth),s<=0?s=0:s+i.offsetHeight>=u.offsetHeight&&(s=u.offsetHeight-i.offsetHeight),i.style.left=o+"px",i.style.top=s+"px",r.onMove&&r.onMove.call(r.target,o,s,r),sjs.event.preventDefault(e)}},sjs.globals.resize={},sjs.startResize=function(e,t){var n=e.sjsEventId;return t=t||{},t._x=t._x||0,t._y=t._y||0,t.r={},t.r.fn="resize",t.r.target=e,sjs.ui.resize._prepareObject(e,t),t.proportions&&(t.r.proportions=sjs(e).width()/sjs(e).height()),t.selection&&(t.r._fn=t.r.fn,t.r.fn="selection"),t.onResize&&!sjs.isFn(t.onResize)&&(t.onResize=!1),sjs(document).on("mousemove").add(sjs.ui.resize[t.r.fn],n),sjs.event.unselect(document.documentElement),sjs.globals.resize[n]=t,n},sjs.stopResize=function(e,t){var n=sjs.globals.resize[t];return n?(sjs.event.select(document.documentElement),sjs.isFn(n.onResizeEnd)&&n.onResizeEnd.call(n.r.target,n,t,e),sjs(document).dettach("mousemove",sjs.ui.resize[n.r.fn]),sjs.globals.resize[t]=null,delete sjs.globals.resize[t],!0):!1},sjs.ui.resize={_setPos:function(){var e=document.documentElement.style,t=document.body.style;return e.width=t.width=e.height=t.height="100%",e=t=null,sjs.browser.msie&&sjs.browser.version<="6.0"?this._setPos=function(e,t,n,r,i){var s=e.offsetParent||document.documentElement,o=s[n]-r+(s["scroll"+i]||0)+(s["client"+i]||0);return t&&(e.style[t]=o+"px"),o}:this._setPos=function(e,t,n,r){var i=e.offsetParent||document.documentElement,s=i[n]-r;return t&&(e.style[t]=s+"px"),s},this._setPos.apply(this,arguments)},_getPosition:function(e){return{bottom:this._setPos(e,!1,"clientHeight",e.offsetHeight+e.offsetTop,"Top"),right:this._setPos(e,!1,"clientWidth",e.offsetWidth+e.offsetLeft,"Left"),top:e.offsetTop,left:e.offsetLeft}},_prepareObject:function(e,t){var n=(t.type||"").charAt(0);switch(n){case"n":t.r.y=e.offsetHeight+e.offsetTop,t.r.oY=-1,t.r.fn="resizeHeight",this._setPos(e,"bottom","clientHeight",e.offsetHeight+e.offsetTop,"Top"),e.style.top="auto";break;case"s":t.r.y=e.offsetTop,t.r.oY=1,t.r.fn="resizeHeight",e.style.top=t.r.y+"px",e.style.bottom="auto"}n=t.type.charAt(1)||n;switch(n){case"w":t.r.x=e.offsetWidth+e.offsetLeft,t.r.oX=-1,t.r.fn=t.r.oY?"resize":"resizeWidth",this._setPos(e,"right","clientWidth",e.offsetWidth+e.offsetLeft,"Left"),e.style.left="auto";break;case"e":t.r.x=e.offsetLeft,t.r.oX=1,t.r.fn=t.r.oY?"resize":"resizeWidth",e.style.left=t.r.x+"px",e.style.right="auto"}t.r.x-=t._x,t.r.y-=t._y},_switchType:function(e,t,n){var r={n:"s",s:"n",e:"w",w:"e"},i=e.type.charAt(1),s=e.type.charAt(0);t&&(e.r.target.style.height="0px",s=r[e.type.charAt(0)]),n&&(e.r.target.style.width="0px",i=r[e.type.charAt(1)],e.type.length==1&&(s=r[e.type.charAt(0)])),i&&(s+=i),e.type!=s&&(e.type=s,i=e.r.fn,this._prepareObject(e.r.target,e),e.r.fn=i)},_setWidth:function(e,t){var n=t.r.target;if(t.parentOffset){var r=n.parentNode,i=t.type.charAt(1)||t.type;i=="w"&&(e>n.offsetWidth&&n.offsetLeft==0||n.offsetLeft<0)?e=n.offsetWidth+n.offsetLeft:i=="e"&&(e>n.offsetWidth&&e+n.offsetLeft==r.offsetWidth||e+n.offsetLeft>r.offsetWidth)&&(e=r.offsetWidth-n.offsetLeft)}return n.style.width=e+"px",e},_setHeight:function(e,t){var n=t.r.target;if(t.parentOffset){var r=n.parentNode,i=t.type.charAt(0);i=="n"&&(e>n.offsetHeight&&n.offsetTop==0||n.offsetTop<0)?e=n.offsetHeight+n.offsetTop:i=="s"&&e>n.offsetHeight&&(e+n.offsetTop==r.offsetHeight||e+n.offsetTop>r.offsetHeight)&&(e=r.offsetHeight-n.offsetTop)}return n.style.height=e+"px",e},resizeHeight:function(e,t){var n=sjs.event.xy(e),r=sjs.globals.resize[t],i=(n.y-r.r.y)*r.r.oY;i=sjs.ui.resize._setHeight(i,r),sjs.event.preventDefault(e),r.onResize&&r.onResize.call(r.r.target,null,i,r)},resizeWidth:function(e,t){var n=sjs.event.xy(e),r=sjs.globals.resize[t],i=(n.x-r.r.x)*r.r.oX;i=sjs.ui.resize._setWidth(i,r),sjs.event.preventDefault(e),r.onResize&&r.onResize.call(r.r.target,i,null,r)},resize:function(e,t){var n=sjs.event.xy(e),r=sjs.globals.resize[t],i=0,s=(n.y-r.r.y)*r.r.oY;s=sjs.ui.resize._setHeight(s,r),r.proportions?i=s*r.r.proportions:i=(n.x-r.r.x)*r.r.oX,i=sjs.ui.resize._setWidth(i,r),sjs.event.preventDefault(e),r.onResize&&r.onResize.call(r.r.target,i,s,r)},selection:function(e,t){var n=sjs.event.xy(e),r=sjs.globals.resize[t],i=(n.x-r.r.x)*r.r.oX,s=(n.y-r.r.y)*r.r.oY,o=r.r.target.clientWidth==0||i<=0,u=r.r.target.clientHeight==0||s<=0;(o||u)&&sjs.ui.resize._switchType(r,u,o),sjs.ui.resize[r.r._fn].call(this,e,t),sjs.event.preventDefault(e)}},sjs.globals.anime={},sjs.prototype.animate=function(e,t,n,r){if(t.start==t.end)return this;var i="boundRect",s="linear";t.time=n*1e3,t.type=sjs.detectStyle(e),t.fps=(1/t.fps).round(3)||.02,t.delta=t.end-t.start,t.unit=t.unit||"px",t.onlyInit=!t.onlyInit;if(e.indexOf("color")+1){var o=3;t.delta=[],s="simple",i="color",t.start=t.start.hex2rgb(),t.end=t.end.hex2rgb();while(o--)t.delta[o]=t.end[o]-t.start[o]}else sjs.ui.animate[t.type]?i=t.type:typeof document.body.style[t.type]!="string"&&(i="prop");return t.style=(t.style||s).trim(),sjs.ui.animate[s=t.style.charAt(0)]&&(t.curStyle=t.style.substring(1),t.style=s),r=!r,this.iterate(function(){var e=sjs.globals.anime,n={progress:null,now:null,curStyle:null,aType:i,offset:1,playState:1};sjs.extend(n,t),e[this.sjsEventId]||(e[this.sjsEventId]={}),e=e[this.sjsEventId],e[t.type]&&window.clearTimeout(e[t.type].timer),n.begin=(new Date).getTime(),n.onlyInit&&(n.timer=sjs.ui.animate[i](this,n)),r&&(e[t.type]=n),n=e=null})},sjs.prototype.detachAnime=function(){var e=arguments;return this.iterate(function(){var t=sjs.globals.anime[this.sjsEventId],n="";for(var r=0,i=e.length;r<i;r++)t&&t[n=sjs.detectStyle(e[r])]&&(window.clearTimeout(t[n].timer),delete t[n]);t=null})},sjs.prototype.pauseAnime=function(){var e=arguments;return this.iterate(function(){var t=sjs.globals.anime[this.sjsEventId],n="";for(var r=0,i=e.length;r<i;r++)t&&t[n=sjs.detectStyle(e[r])]&&t[n].timer&&(window.clearTimeout(t[n].timer),t[n].timer=-1,sjs.isFn(t[n].onPause)&&t[n].onPause.call(sjs.ui.animate,this,t[n]));t=null})},sjs.prototype.playAnime=function(){var e=arguments;return this.iterate(function(){var t=sjs.globals.anime[this.sjsEventId],n="";for(var r=0,i=e.length;r<i;r++){n=sjs.detectStyle(e[r]);if(t&&t[n]&&t[n].timer==-1){var s=t[n];s.begin=(new Date).getTime()-s.now,sjs.ui.animate[s.aType](this,s),s=null}}t=null})},sjs.prototype.stopAndPlayBackAnime=function(){var e=arguments;return this.iterate(function(){var t=sjs.globals.anime[this.sjsEventId],n="";for(var r=0,i=e.length;r<i;r++){n=sjs.detectStyle(e[r]);if(t&&t[n]&&t[n].timer){var s=t[n];window.clearTimeout(s.timer),sjs.isFn(s.onChangeState)&&s.onChangeState.call(sjs.ui.animate,this,s),s.begin=(new Date).getTime()+s.playState*s.now,s.playState=-s.playState,sjs.ui.animate[s.aType](this,s),s=null}}t=null})},sjs.ui.animate={"!":function(e,t,n){return this[n](1-e,t)},"~":function(e,t,n){return 1-this[n](1-e,t)},"&":function(e,t,n){return e<=.5?this[n](2*e,t)/2:1-this[n](2*(1-e),t)/2},linear:function(e){return e},simple:function(e){return(1-Math.cos(Math.PI*e))/2},pow:function(e,t){return Math.pow(e,t)},shot:function(e,t){return Math.pow(e,2)*((t+1)*e-t)},bounce:function(e){var t=0,n=1;while(e<(7-4*t)/11)t+=n,n/=2;return-Math.pow((11-6*t-11*e)/4,2)+Math.pow(n,2)},elastic:function(e,t){return Math.pow(2,10*(e-1))*Math.cos(20*e*Math.PI*t/3)},circ:function(e){return 1-Math.sqrt(1-e*e)},repeat:function(e,t){t.begin=(new Date).getTime(),this[t.aType](e,t)},revert:function(e,t){t.style=="~"?(t.style=t.curStyle,t.curStyle=null):(t.curStyle=t.style,t.style="~"),t.begin=(new Date).getTime(),this[t.aType](e,t)},reverse:function(e,t){t.style=="!"?(t.style=t.curStyle,t.curStyle=null):(t.curStyle=t.style,t.style="!"),t.begin=(new Date).getTime(),this[t.aType](e,t)},boundRect:function(e,t){t.now=((new Date).getTime()-t.begin)*t.playState,t.progress=t.now/t.time,(t.progress>0||t.playState==1)&&(t.progress<1||t.playState==-1)?(e.style[t.type]=(t.delta*sjs.ui.animate[t.style](t.progress,t.offset,t.curStyle)+t.start).round(5)+t.unit,t.timer=arguments.callee.delay(t.fps,e,t)):(e.style[t.type]=(t.playState+1&&t.end||t.start)+t.unit,t.timer=-2,t.onEnd&&t.onEnd.call(sjs.ui.animate,e,t),e=t=null)},opacity:function(e,t){t.now=((new Date).getTime()-t.begin)*t.playState,t.progress=t.now/t.time;if((t.progress>0||t.playState==1)&&(t.progress<1||t.playState==-1)){var n=t.delta*sjs.ui.animate[t.style](t.progress,t.offset,t.curStyle)+t.start;sjs.setOpacity(e,n.round(2)),t.timer=arguments.callee.delay(t.fps,e,t)}else t.playState+1?sjs.setOpacity(e,t.end):sjs.setOpacity(e,t.start),t.timer=-2,t.onEnd&&t.onEnd.call(sjs.ui.animate,e,t),e=t=null},prop:function(e,t){t.now=((new Date).getTime()-t.begin)*t.playState,t.progress=t.now/t.time,(t.progress>0||t.playState==1)&&(t.progress<1||t.playState==-1)?(e[t.type]=(t.delta*sjs.ui.animate[t.style](t.progress,t.offset,t.curStyle)+t.start).round(5),t.timer=arguments.callee.delay(t.fps,e,t)):(e[t.type]=t.playState+1&&t.end||t.start,t.timer=-2,t.onEnd&&t.onEnd.call(sjs.ui.animate,e,t),e=t=null)},color:function(e,t){t.now=((new Date).getTime()-t.begin)*t.playState,t.progress=t.now/t.time;if((t.progress>0||t.playState==1)&&(t.progress<1||t.playState==-1)){var n=[],r=3,i=sjs.ui.animate[t.style](t.progress,t.offset,t.curStyle);while(r--)n[r]=Math.floor(t.start[r]+i*t.delta[r]+.5);e.style[t.type]="rgb("+n.join(",")+")",t.timer=arguments.callee.delay(t.fps,e,t)}else e.style[t.type]="rgb("+(t.playState+1&&t.end||t.start).join(",")+")",t.timer=-2,t.onEnd&&t.onEnd.call(sjs.ui.animate,e,t),e=t=null}},sjs.query=function(e,t,n,r,i,s){var o=new $_Request;return o.caching=!r,o.watchCaching=!0,o.onload=n,s=s||{},sjs.isFn(s.onerror)&&(o.onerror=s.onerror),i&&(o.args=i),s.loader&&(this.loader=s.loader),o.onreadystatechange=function(){this.readyState==4&&sjs.isFn(this.onload)&&(this.onload(this.responseJS,this.responseText),this.args=null)},o.open(s.method||null,e,!0),o.send(t),o};var $_Request=new sjs.plugin({onreadystatechange:null,onload:null,readyState:0,responseText:null,responseJS:null,status:200,statusText:"OK",caching:!1,watchCaching:!1,loader:null,session_name:"PHPSESSID",load:null,headers:[],attr:null,_errors:{inv_form_el:"Invalid FORM element detected: name=%, tag=%",must_be_single_el:"If used, <form> must be a single HTML element in the list.",js_invalid:"JavaScript code generated by backend is invalid!\n%",url_too_long:"Cannot use so long query with GET request (URL is larger than % bytes)",unk_loader:"Unknown loader: %",no_loaders:"No loaders registered at all, please check Request.LOADERS array",no_loader_matched:"Cannot find a loader which may process the request. Notices are:\n%",script_only_get:"Cannot use SCRIPT loader: it supports only GET method",script_no_form:"Cannot use SCRIPT loader: direct form elements using and uploading are not implemented",xml_no:"Cannot use XMLHttpRequest or ActiveX loader: not supported",xml_no_diffdom:"Cannot use XMLHttpRequest to load data from different domain %",xml_no_headers:"Cannot use XMLHttpRequest loader or ActiveX loader, POST method: headers setting is not supported, needed to work with encodings correctly",xml_no_form_upl:"Cannot use XMLHttpRequest loader: direct form elements using and uploading are not implemented",form_el_not_belong:'Element "%" does not belong to any form!',form_el_belong_diff:'Element "%" belongs to a different form. All elements must belong to the same form!',form_el_inv_enctype:'Attribute "enctype" of the form must be "%" (for IE), "%" given.'},getSession:function(){var e=document.location.search.match(new RegExp("[&?]"+this.session_name+"=([^&?]*)")),t=document.cookie.match(new RegExp("(?:;|^)\\s*"+this.session_name+"=([^;]*)"));return e||t?RegExp.$1:""},onerror:function(e,t){alert("Error request [status = "+this.status+"]:\n\n"+this.getAllResponseHeaders()+"\n\nurl: "+this.load.url)},abort:function(){this.load&&this.load.abort&&this.load.abort(),this._cleanup();if(this.readyState==0)return;if(this.readyState==1&&!this.load){this.readyState=0;return}this._changeReadyState(4,!0)},open:function(e,t,n,r,i){t.match(/^((\w+)\.)?(GET|POST)\s+(.*)/i)&&(this.loader=RegExp.$2?RegExp.$2:null,e=RegExp.$3,t=RegExp.$4);try{var s=this.getSession();s&&(t+=(t.indexOf("?")>=0?"&":"?")+this.session_name+"="+this.escape(s))}catch(o){}return this.attr={method:(e||"").toUpperCase(),url:t,asyncFlag:n,username:r!=null?r:"",password:i!=null?i:""},this.loader=null,this._changeReadyState(1,!0),!0},send:function(e){if(!this.readyState)return;this._changeReadyState(1,!0),this.load=null;var t=[],n=[],r=null;if(!this.hash2query(e,null,t,n))return;r=this.attr.user+":"+this.attr.pass+"@"+this.attr.url+"|"+t+"#"+this.attr.method;if(this.caching&&!n.length){var i=$_Request.CACHE[r];if(i)return this._dataReady(i[0],i[1]),!1}else this.watchCaching&&$_Request.CACHE[r]&&($_Request.CACHE[r]=null,delete $_Request.CACHE[r]);var s=(this.loader||"").toLowerCase(),o=[];if(s&&!$_Request.LOADERS[s])return this._error("unk_loader",s);var u=$_Request.LOADERS,a=null;for(a in u){var f=u[a];if(!f)continue;if(s&&a!=s)continue;var l=new f(this,{queryText:t.join("&"),queryElem:n,id:(new Date).getTime()+""+$_Request.COUNT++,hash:r,span:null}),c=l.load(this);if(!c)return this.load=l,$_Request.PENDING[l.id]=this,!0;if(!!s)return this._error(c);o.push("- "+a.toUpperCase()+": "+this._l(c))}return a?this._error("no_loader_matched",o.join("\n")):this._error("no_loaders")},getAllResponseHeaders:function(){return this.load&&this.load.getAllResponseHeaders?this.load.getAllResponseHeaders():[]},getResponseHeader:function(e){return this.load&&this.load.getResponseHeader?this.load.getResponseHeader(e):null},setRequestHeader:function(e,t){this.headers.push([e,t])},_dataReady:function(e,t){var n=this;n.caching&&n.load&&($_Request.CACHE[n.load.hash]=[e,t]),n.responseText=e,n.responseJS=t,t!==null?(n.status=200,n.statusText="OK"):(n.status=500,n.statusText="Internal Server Error"),n._changeReadyState(2),n._changeReadyState(3),n._changeReadyState(4),n._cleanup(),n=null},_l:function(e){var t=0,n=0,r=this._errors[e[0]];while((n=r.indexOf("%",n))>=0){var i=e[++t]+"";r=r.substring(0,n)+i+r.substring(n+1,r.length),n+=1+i.length}return r},_error:function(e){e=this._l(typeof e=="string"?arguments:e),sjs.newError("Request: "+e)},hash2query:function(e,t,n,r){t==null&&(t="");if((""+typeof e).toLowerCase()=="object"){var i=!1,s;sjs.nodeName(e,"form")&&(e={form:e});for(var o in e){s=e[o];if(sjs.isFn(s))continue;var u=t?t+"["+this.escape(o)+"]":this.escape(o),a=s&&s.parentNode&&s.parentNode.appendChild&&s.tagName;if(a){var f=s.tagName.toUpperCase();if(f=="FORM")i=!0;else if(f!="INPUT"&&f!="TEXTAREA"&&f!="SELECT")return this._error("inv_form_el",s.name||"",s.tagName);r[r.length]={name:u,e:s}}else if(s instanceof Object)this.hash2query(s,u,n,r);else{if(s===null)continue;if(s===!0)s=1;else if(s===!1||s===undefined)s="";n[n.length]=u+"="+this.escape(""+s)}if(i&&r.length>1)return this._error("must_be_single_el");i=!1}}else n[n.length]=e;return!0},_cleanup:function(){var e=this.load;if(!e)return;$_Request.PENDING[e.id]=!1;var t=e.span;if(!t)return;e.span=null,t.parentNode.removeChild(t)},_changeReadyState:function(e,t){t&&(this.status=this.statusText=this.responseJS=null,this.responseText=""),this.readyState=e,this.onreadystatechange&&this.onreadystatechange()},escape:function(e){return escape(e).replace(new RegExp("\\+","g"),"%2B")},isSucess:function(){return this.status>=200&&this.status<300}});$_Request.COUNT=0,$_Request.MAX_URL_LEN=2e3,$_Request.CACHE={},$_Request.PENDING={},$_Request.dataReady=function(e){var t=this.PENDING[e.id];delete this.PENDING[e.id],t?t._dataReady(e.text,e.js):t!==!1&&sjs.newError("dataReady(): unknown pending id: "+e.id)},$_Request.get=function(){return window.XMLHttpRequest?$_Request.get=function(){return new window.XMLHttpRequest}:$_Request.get=function(){var e=null;try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}}return e},$_Request.get()},$_Request.attr=function(e,t,n){return this.attr=sjs.browser.msie?sjs.setAttrNode:sjs.setAttr,this.attr(e,t,n)},$_Request.LOADERS={xml:new sjs.plugin({__construct:function(e,t){sjs.extend(this,t,e.attr)},load:function(e){if(this.queryElem.length)return["xml_no_form_upl"];if(/^([a-z]+:\/\/[^\\\/]+)(.*)/i.test(this.url)&&RegExp.$1.toLowerCase()!=document.location.protocol+"//"+document.location.hostname.toLowerCase())return["xml_no_diffdom",RegExp.$1];var t=$_Request.get(),n;if(!t)return["xml_no"];n=!!window.ActiveXObject||!!t.setRequestHeader,this.method||(this.method=n&&this.queryText.length?"POST":"GET");if(this.method=="GET"){this.queryText&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+this.queryText),this.queryText="";if(this.url.length>
$_Request.MAX_URL_LEN)return["url_too_long",$_Request.MAX_URL_LEN]}else if(this.method=="POST"&&!n)return["xml_no_headers"];this.url+=(this.url.indexOf("?")>=0?"&":"?")+"_JsRequest="+(e.caching?"0":this.id)+"-xml";var r=this.id;t.onreadystatechange=function(){if(t.readyState!=4)return;t.onreadystatechange=sjs.$empty,e.status=null;try{e.status=t.status,e.responseText=t.responseText}catch(n){}if(!e.isSucess())return e.onerror();try{sjs.trim(e.responseText).charAt(0)!="{"||e.withoutBackEnd?($_Request._tmp=function(e){var t=arguments.callee.data;arguments.callee.data=null,t.id=e,$_Request.dataReady(t)},$_Request._tmp.data={js:t.responseXML,text:e.responseText}):$_Request._tmp=new Function("id","var d="+e.responseText+"; d.id = id; $_Request.dataReady(d)")}catch(n){return e._error(["js_invalid"])}$_Request._tmp(r),$_Request._tmp=null},t.open(this.method,this.url,!0,this.username,this.password);if(n){for(var i=0,s=e.headers.length;i<s;i++)t.setRequestHeader(e.headers[i][0],e.headers[i][1]);t.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}return t.send(this.queryText),this.span=null,this.tr=t,null},getAllResponseHeaders:function(){return this.tr.getAllResponseHeaders()},getResponseHeader:function(e){return this.tr.getResponseHeader(e)},abort:function(){this.tr.abort(),this.tr=null}}),script:new sjs.plugin({__construct:function(e,t){sjs.extend(this,t,e.attr)},load:function(){this.queryText&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+this.queryText),this.url+=(this.url.indexOf("?")>=0?"&":"?")+"_JsRequest="+this.id+"-"+"script",this.queryText="",this.method||(this.method="GET");if(this.method!=="GET")return["script_only_get"];if(this.queryElem.length)return["script_no_form"];if(this.url.length>$_Request.MAX_URL_LEN)return["url_too_long",$_Request.MAX_URL_LEN];this.span=sjs.newTag("script"),this.span.setAttribute("type","text/javascript"),document.body.appendChild(this.span);var e=function(e,t){e.setAttribute("src",t)};return e.delay(.01,this.span,this.url),null}}),form:new sjs.plugin({__construct:function(e,t){sjs.extend(this,e.attr,t)},load:function(){var e=this;e.url+=(e.url.indexOf("?")>=0?"&":"?")+"_JsRequest="+e.id+"-"+"form";if(e.method=="GET"){e.queryText&&(e.url+="&"+e.queryText);if(e.url.length>$_Request.MAX_URL_LEN)return["url_too_long",$_Request.MAX_URL_LEN];var t=e.url.split("?",2);e.url=t[0],e.queryText=t[1]||""}var n=null;if(e.queryElem.length)if(sjs.nodeName(e.queryElem[0].e,"form"))n=e.queryElem[0].e,e.queryElem=[];else{var r=e.queryElem.length,i;n=e.queryElem[0].e.form;while(r--){i=e.queryElem[r].e;if(!i.form)return["form_el_not_belong",i.name];if(i.form!=n)return["form_el_belong_diff",i.name]}}if(!e.method){var s=sjs.getAttrNode(n,"encType");e.method="POST";if(s!="multipart/form-data")return["form_el_inv_enctype","multipart/form-data",s]}var o="sjs_load_"+e.id,u;e.span=sjs.newTag("div"),sjs.extend(e.span.style,{position:"absolute",display:"none"}),u='<iframe name="'+o+'" id="'+o+'" style="width:0; height:0;display:none"></iframe>',n?e.span.innerHTML=u:(e.span.innerHTML=u+"<form"+(e.method=="POST"?' enctype="multipart/form-data" method="post"':"")+"></form>",n=e.span.firstChild),u=null,document.body.appendChild(e.span);var a=function(){var e=arguments.callee.data,t=e[1].split("&"),n=e[0],r=e[2],i=new Array,s={},o=new Array,u=r.length&&n.elements.length,a=n.elements,f;this.data=null;while(u--)a[u].disabled||(a[u].disabled=!0,o[o.length]=a[u]);u=t[0]&&t.length;while(u--)a=t[u].split("=",2),f=sjs.newTag("input"),f.type="hidden",f.name=unescape(a[0]),f.value=a[1]!=null?unescape(a[1]):"",n.appendChild(f);u=r.length;while(u--)a=r[u],i.push(a.e.name),a.e.name=a.name,a.e.disabled=!1;a={action:e[3],method:e[4],target:e[5]};for(u in a)s[u]=sjs.getAttrNode(n,u)||"",$_Request.attr(n,u,a[u]);n.submit(),u=o.length;while(u--)o[u].disabled=!1;u=r.length;while(u--)r[u].e.name=i[u];for(u in s)$_Request.attr(n,u,s[u]);u=t[0]&&t.length;while(u--)n.removeChild(n.lastChild);t.length=o.length=0,e=f=a=o=s=i=last=t=n=r=null};return a.data=[n,e.queryText,e.queryElem,e.url,e.method,o],a.delay(.1),e=null,null}})},sjs.globals.windows={};var sjWindow=new sjs.plugin({__construct:function(e,t,n){this.id=null,this.url=e,this.clone=null,this.modal=null,this.window=null,this.onload=n,this.onclose=null,this.moveCfg=null,this.resizeCfg=null,this.onmaximize=null,this.onunmaximize=null,this.onminimize=null,this.onChangeSize=t.onChangeSize,this.arguments=t.arguments||{},this.randPosition=t.randPosition,this.initialize(t)},__destruct:function(){sjWindow.count--,this.resizeCfg=this.moveCfg=this.modal=this.onload=sjs.globals.windows[this.id]=this.onclose=this.window=this.url=null,delete this.moveCfg,delete this.resizeCfg,delete sjs.globals.windows[this.id],this.onunmaximize=this.onmaximize=this.onminimize=this.clone=this.id=null,this.arguments=null},initialize:function(e){e.useTagAsWindow?this.window=sjs(e.tmpl):e.tmpl?this.window=sjs(sjs.querySelector(e.tmpl)[0].cloneNode(1)):this.window=sjs('<div><div class="sjs_wcontent"></div></div>'),this.id=this.window.css({position:"absolute",display:"none",zIndex:sjWindow.max_zIndex++}).setClass("sjs_window").attr("id","sjs_window_"+ ++sjWindow.count).onEvent("mousedown",function(){if(sjWindow.count>1){this.style.zIndex=sjWindow.max_zIndex++;var e=sjs.globals.windows[this.sjsEventId];e.clone&&(e.clone.style.zIndex=sjWindow.max_zIndex++),e=null}})[0].sjsEventId,this.window=this.window[0];var t=this.attachTitle(e.title,e.tmb);if(e.action&&e.action!="111"){content=this.find(".sjs_waction a");for(var n=0;n<3;n++)e.action.charAt(n)!="1"&&(content[n].style.display="none")}e.resizable&&this.attachResize(e.useSelf),e.isModal&&this.setModal(),document.body.appendChild(this.window),this.position(e.randPosition),!e.useSelf&&(e.move||e.resizable)&&this.attachClone(),e.move&&this.attachMove(t,e.move,e.useSelf),this.url&&!e.content?this.getContent(e.postData):this.setContent(e.content),sjs.globals.windows[this.id]=this,t=img=content=null},attachTitle:function(e,t){var n=sjs(".sjs_wtop",this.window).unselectable();n.find(".sjs_waction").onEvent("click",this.action,this.id).onEvent("mousedown",function(e){e.cancelBubble=!0}),n.find(".sjs_wtitle").text(e).unselectable();try{n.find("img")[0].sjs_window_src=t}catch(r){this.onChangeContent=function(){return this.toContentSize()}}return n},setArguments:function(e){return sjs.extend(this.arguments,e),this},attachMove:function(e,t,n){typeof t!="object"&&(t={}),n?t.caller="window":(t.caller="clone",this.onDragStart=function(e){var t=sjs.globals.windows[this.parentNode.sjsEventId];t.showClone(),sjWindow.prototype.onDragStart.call(this,e)},this.onDragEnd=function(e){var t=sjs.globals.windows[e.id].window;e.animate?sjs(t).animate("left",{start:t.offsetLeft,end:this.offsetLeft},.5).animate("top",{start:t.offsetTop,end:this.offsetTop},.5):(t=t.style,t.left=this.offsetLeft+"px",t.top=this.offsetTop+"px"),sjWindow.prototype.onDragEnd.apply(this,arguments),this.style.display="none",t=e=null}),e.onEvent("mousedown",this.onDragStart),t.onDragEnd=this.onDragEnd,t.id=this.id,this.moveCfg=t,e=t=null},onDragStart:function(e){var t=sjs.event.xy(e),n=sjs.globals.windows[this.parentNode.sjsEventId],r=n.moveCfg;r._x=t.x-n[r.caller].offsetLeft,r._y=t.y-n[r.caller].offsetTop,sjs(document).on("mouseup").add(sjs.stopDrag,sjs.startDrag(n[r.caller],r)),r=n=null},onDragEnd:function(e){sjs(document).dettach("mouseup",sjs.stopDrag)},setModal:function(){var e=sjs.newTag("div");return e.style.backgroundColor="#fff",document.body.appendChild(e),sjs.setOpacity(e,.6),this.setModalPosition(e),e.style.zIndex=this.window.style.zIndex,sjWindow.max_zIndex=++this.window.style.zIndex,this.modal=e,this},setModalPosition:function(e){return sjs.browser.msie&&sjs.browser.version<="6.0"?sjWindow.prototype.setModalPosition=function(e){e=e.style,e.position="absolute",e.top="0px",e.left="0px",e.height=document.documentElement.scrollHeight||document.body.scrollHeight+"px",e.width=document.documentElement.scrollWidth||document.body.scrollWidth+"px"}:sjWindow.prototype.setModalPosition=function(e){e=e.style,e.position="fixed",e.top="0px",e.left="0px",e.height="100%",e.width="100%"},this.setModalPosition(e),this},attachResize:function(e){sjs.className.has(this.window,"sjsResizable")||sjs.className.set(this.window,"sjsResizable"),e||(this.onResizeEnd=function(e){var t=sjs.globals.windows[e.id].window.style,n=this.style;t.top=this.offsetTop+"px",t.left=this.offsetLeft+"px",t.height=n.height,t.width=n.width,n.display="none",sjWindow.prototype.onResizeEnd.apply(this,arguments),e=t=n=null},this.onResizeStart=function(e,t){var n=sjs.event.caller(e);if(!sjs.className.has(n,"sjsResize"))return!1;var r=sjs.globals.windows[t],i=r.resizeCfg;return r.showClone(),i.type=n.id,r.clone.style.display="block",sjs(document).on("mouseup").add(sjs.stopResize,sjs.startResize(r.clone,i)),i=r=null,!1}),this.resizeCfg={id:this.id,_x:1,_y:1,onResizeEnd:this.onResizeEnd},sjs(".sjs_resize",this.window).onEvent("mousedown",this.onResizeStart,this.id)},onResizeStart:function(e,t){var n=sjs.event.caller(e);if(!sjs.className.has(n,"sjsResize"))return!1;var r=sjs.globals.windows[t],i=r.resizeCfg;i.type=n.id,sjs(document).on("mouseup").add(sjs.stopResize,sjs.startResize(r.window,i)),i=r=content=null},onResizeEnd:function(e){sjWindow.expandContent(sjs.globals.windows[e.id].window),sjs(document).dettach("mouseup",sjs.stopResize),e=null},getContent:function(e){var t=function(e,t){var n=sjs.globals.windows[arguments.callee.id];n.setContent(t,new Array(e,t)),arguments.callee.id=e=null};t.id=this.id,sjs.query(this.url,e,t,1)},setContent:function(e,t){var n=sjs(".sjs_wcontent",this.window);typeof e!="undefined"&&(typeof e!="object"?n.html(e):n.append(e)),sjs(this.window).css("display","block"),this.onChangeContent(sjs(".upload_img",this.window)),sjs.isFn(this.onload)&&this.onload.apply(this,[n].concat(t))},onChangeContent:function(e){return e[0].sjs_window_src?(this.getContent=function(){var e=sjs(".upload_img",this.window).attr("src",sjs.getAttr(e[0],"alt"));sjWindow.prototype.getContent.apply(this,arguments)},this.onChangeContent=function(e){return e.attr("src",e[0].sjs_window_src),this.toContentSize()}):(this.onChangeContent=function(e){return e.css("display","none"),this.toContentSize()},this.getContent=function(){sjs(".upload_img",this.window).css("display",""),sjWindow.prototype.getContent.apply(this,arguments)}),this.onChangeContent(e)},attachClone:function(){var e=sjs(this.window.cloneNode(0));return e.css({position:"absolute",display:"none",visibility:"visible",zIndex:sjWindow.max_zIndex++,width:this.window.offsetWidth+"px",height:this.window.offsetHeight+"px"}).appendTo(document.body)[0].id="",this.clone=e[0],e[0].className="sjs_window sjsClone",this},showClone:function(){return sjs(this.clone).css({display:"block",zIndex:sjWindow.max_zIndex+1,width:this.window.offsetWidth+"px",height:this.window.offsetHeight+"px",top:this.window.offsetTop+"px",left:this.window.offsetLeft+"px"}),this},action:function(e,t){e.cancelBubble=!0;var n=sjs.event.caller(e);if(!sjs.nodeName(n,"a"))return!1;var r=sjs.globals.windows[t];switch(n.className){case"close":r.close(e,n);break;case"minimize":sjs.isFn(r.onminimize)&&r.onminimize(e,n);break;case"maximize":sjs.isFn(r.onmaximize)&&r.onmaximize(e,n),n.className="unmaximize";break;case"unmaximize":sjs.isFn(r.onunmaximize)&&r.onunmaximize(e,n),n.className="maximize"}return n=w=null,!1},position:function(e){var t=sjs.getBrowserWindowSize(),n=sjs.getBrowserWindowScrolls();if(e)this.window.style.top=sjs.rand(n.top+10,t.height/2+n.top)+"px",this.window.style.left=sjs.rand(n.left+100,t.width/2+n.left)+"px";else{var r=sjs(this.window),i=(t.height-r.height())/2+n.top,s=(t.width-r.width())/2+n.left;this.window.style.top=(i<=0?10:i)+"px",this.window.style.left=(s<=0?10:s)+"px"}return this},setSize:function(e,t){return this.window.style.width=e+"px",this.window.style.height=t+"px",this.position(this.randPosition),sjWindow.expandContent(this.window)},close:function(e,t){var n=!0;sjs.isFn(this.onclose)&&(n=this.onclose(e,t)),n!==!1&&(this.window.parentNode.removeChild(this.window),this.modal&&this.modal.parentNode.removeChild(this.modal),this.clone&&this.clone.parentNode.removeChild(this.clone),this.__destruct())},display:function(e){var t=[this.window,this.modal],n=t.length;e=e=="show"?"block":"none";while(n--)t[n]&&(t[n].style.display=e,e=="block"&&(t[n].style.zIndex=sjWindow.max_zIndex++));return this},show:function(){return(!sjs.isFn(this.onShow)||this.onShow()!==!1)&&this.display("show"),this},hide:function(){return(!sjs.isFn(this.onHide)||this.onHide()!==!1)&&this.display("hide"),this},toContentSize:function(){var e=sjs(".sjs_wcontent",this.window);return sjs.isFn(this.onChangeSize)&&this.onChangeSize(e),this.resizeCfg&&sjWindow.expandContent(this.window,e),e},toInnerSize:function(){var e=this.find(".sjs_wcontent"),t=e.getSize(),n=t.margin[1]+t.margin[3],r=t.margin[0]+t.margin[2];return sjs(this.window).css({width:t.width+n+"px"}),e},find:function(e){return sjs(e,this.window)}});sjWindow.count=0,sjWindow.max_zIndex=1e3,sjWindow.expandContent=function(e,t){var t=t||sjs(".sjs_wcontent",e),n=t.sjs&&t.getSize()||sjs.getSize(t),r=0,i=0;for(var s in n)n[s].constructor==Array&&(r+=n[s][0]+n[s][2],i+=n[s][1]+n[s][3]);return n=t.parent().getSize(),r+=n.padding[0]+n.padding[2],i+=n.padding[1]+n.padding[3],t.css({height:sjs(e).height()-r-sjs(".sjs_wtop",e).height()+"px",width:sjs(e).width()-i+"px"}),t},sjWindow.renderView=function(e){var t=sjs('<div class="sjs_waction" />').append('<a href="#" class="minimize" tabindex="0" />').append('<a href="#" class="maximize" tabindex="0" />').append('<a href="#" class="close" tabindex="0" />'),n=sjs('<div id="sjWindowTmpl" class="hide ie6_width_fix" />').append('<div class="sjs_wtop" />').append('<div class="window_main" />').append('<div class="sjs_resize" />'),r="",i=["n","s","e","w","ne","nw","se","sw"],s=i.length;while(s--)r+='<span class="sjsResize '+i[s]+'" id="'+i[s]+'"></span>';return n.setClass(e).first().append('<div class="sjs_wltitle" />').append('<div class="sjs_wrtitle" />').append('<div class="sjs_wtitle" />').append(t).next().append('<div class="bbottom" />').append('<div class="bleft" />').append('<div class="bright" />').append('<div class="sjs_wcontent" />').next().html(r),n.appendTo(document.body)},function(){sjs.globals.fm={};var e=new sjs.plugin({__construct:function(e,t,n){this._create(e,t,n)},__destruct:function(){delete sjs.globals.fm[this.id],this.clearStek("dir","file");for(name in this.windows)this.windows[name].__destruct&&this.windows[name].__destruct();this.windows=this.requestData=this.events=this.lastSelected=this.id=null},_request:function(e,t){var n=new sjs.promise;return sjs.query(e,t,function(e,t){n.resolve({js:e,html:t})},!0),n},_create:function(e,t,n){this.id=e[0].sjsEventId,this.actionUrl=(t.actionUrl||"").replace(/[\\\/]+$/,"")+"/",this.dirUrl=t.dirUrl||this.actionUrl,this.rootUrl=(t.rootUrl||"").replace(/[\\\/]+$/,""),this.events=n||{},this.dirStek=null,this.fileStek=null,this.windows={},this.requestData={},this.lastSelected=null,this.actionsBlock=sjs(t.actionSel||"#sjFmActions"),this.hasStekChanges=!1,this.rowTemplate="",this.findLastSelected(e.first()[0]),this.setUploader(t.uploader),this.setRowTemplate(t.rowTemplate),this.initialize(e),sjs.globals.fm[this.id]=this,this.notify("ready",e)},findLastSelected:function(e){return e=e.tBodies[0],e.rows[0]&&(this.lastSelected=e.rows[0].id=="parent-dir"&&e.rows[1]||e.rows[0]),e},select:function(e){var t=e.offsetParent.rows,n=this.lastSelected.rowIndex,r=e.rowIndex,i=Math.abs(r-n)+1,s=n>r&&n||r;while(i--)this.checked(t[s-i],"selected",1)},choose:function(e,t){return e.className?this.checked(e,"",!t):(this.lastSelected=e,this.checked(e,"selected",t)),this},checked:function(e,t,n){var r=e.firstChild.firstChild;return e.className=t,sjs.nodeName(r,"input")&&(r.checked=n),this},getChecked:function(e){return sjs("tr.selected",e||this.lastSelected.parentNode)},makeStek:function(){if(!this.hasStekChanges)return!1;var e=[],t=[];return this.getChecked().iterate(function(){var n=sjs('input[type="checkbox"]',this.cells[0]);if(!n.length)return!0;var r=this.cells[1];n=n[0],sjs.className.has(r,"dir")?t[t.length]=n.value:e[e.length]=n.value}),this.fileStek=e,this.dirStek=t,this.hasStekChanges=!1,t=e=null,this},getFiles:function(){var e=this.rootUrl+this.getCurrentPath(),t=[],n=this.fileStek&&this.fileStek.length||0;e=e.replace(/\/+$/,"")+"/";while(n--)t[t.length]=e+this.fileStek[n];return t},clearStek:function(){var e=arguments.length,t="";this.hasStekChanges=!1;while(e--)t=arguments[e]+"Stek",this[t]&&(this[t]=null)},emptyStek:function(){return!this.dirStek&&!this.fileStek||!this.dirStek.length&&!this.fileStek.length},getCurrentPath:function(e){return e&&this.findLastSelected(e),this.lastSelected?this.lastSelected.parentNode.className:"/"},displayFullPath:function(e){this.notify("displayPath",e)},open:function(e){e=e.trim(),e&&e!=this.getCurrentPath()&&this.doAction("opendir",e,this.lastSelected)},reset:function(){return this.clearStek("dir","file"),this.getContent().find('input[type="checkbox"]:checked').iterate(function(){sjs(this.parentNode.parentNode).removeClass("selected"),this.checked=!1}),this.restoreDefaultActions(),this},initialize:function(t){this.reset(),e.link(t[0],this.id),e.link(this.actionsBlock[0],this.id),t.unselectable().onEvent("mousedown",function(t){var n=sjs.event.caller(t),r=sjs.event.key(t),i=e.get(this),s=5,o=n;while(n&&s--&&!sjs.nodeName(n,"td")&&!sjs.nodeName(n,"th"))n=n.parentNode;if(sjs.nodeName(n,"td"))i.prepareContent(n,r,o);else{if(!sjs.nodeName(n,"th"))return!0;i.prepareHeaders(n,r,o),sjs.event.preventDefault(t)}i.notify("click",n.parentNode)}).onEvent("dblclick",function(t){var n=sjs.event.caller(t),r=sjs.event.key(t),i=e.get(this),s,o=10,u=sjs.nodeName(n,"input");while(n&&!sjs.nodeName(n,"td")&&o--)n=n.parentNode;if(r.shift||r.ctrl||!sjs.nodeName(n,"td")||u)return!1;s=n.parentNode;if(sjs(".folder",s).setClass("loading").length){var a=sjs.getText(s.cells[1])||"";i.hasStekChanges=!0,i.doAction("opendir",i.getCurrentPath()+a.trim(),s)}i.notify("dblclick",s),sjs.event.preventDefault(t)}),this.actionsBlock.unselectable().onEvent("click",function(t){var n=sjs.event.caller(t),r=e.get(this);return!sjs.nodeName(n,"a")||!r.isActionEnabled(n)?!1:(r.doAction(n.name,n),!1)});var n=t.parent().parent(),r=sjs('<div id="sjPath" />').unselectable().onEvent("click",function(t){var n=sjs.event.caller(t);if(!sjs.nodeName(n,"a"))return!0;var r=e.get(this),i=n.href.substr(n.href.lastIndexOf("#")+1);r.open(i),sjs.event.preventDefault(t)}).appendTo(n);e.link(r.item(0),this.id),sjs('<div id="sjPopup" />').insertBefore(n),this.addStandardHandlers(),this.displayFullPath(this.getCurrentPath())},prepareContent:function(e,t,n){var r=e.parentNode,i=this.getChecked(r.parentNode),s=this,o=n&&n.type=="checkbox";t.shift?(i.iterate(function(){s.checked(this,"",0)}),this.checked(r,"selected",1),this.select(r)):t.ctrl||o?this.choose(r,!o):(this.lastSelected=r,i.iterate(function(){s.checked(this,"",0)}),this.checked(r,"selected",1)),this.hasStekChanges=!0,this.prepareActions()},prepareHeaders:function(e,t,n){var r=this;if(n&&n.type=="checkbox"){var i=n.checked;sjs("tr",this.lastSelected.parentNode).iterate(function(){if(sjs("label.parent-dir",this).length)return!0;i?r.checked(this,"",0):r.checked(this,"selected",1)})}},setRowTemplate:function(e){if(!e){var t=["tcenter padding-left-0 width40","list-current","width70",null,"width110"],n=t.length,r=-1,i="";e=sjs(sjs.newTag("tr"));while(++r<n)i=sjs.newTag("td"),i.className=t[r],i.innerHTML="&nbsp;",e.append(i);e.find("td:nth-child(2)").html("<label />").prev().append('<input type="checkbox" name="files[]" />')}return this.rowTemplate=e,this},getRowTemplate:function(e){var t=sjs(this.rowTemplate.item(0).cloneNode(!0)),n="default",r="file";switch(e){case"dir":n="folder",r="dir";break;default:n="default "+String(e).toLowerCase(),r="file"}return t.find("td label").setClass(n).parent().setClass(r),t},addRow:function(e){var t=this.getRowTemplate(e.type),n=t.find("td");return n.nth(0).first().value(e.basename),n.nth(1).first().text(e.name),n.nth(2).text(e.type=="dir"?" ":e.type),n.nth(3).text(e.size),n.nth(4).text(e.modify),this.getContent().find("tbody").append(t),this},addStandardHandlers:function(){return this.hasListeners("serverError")||this.addListener("serverError",function(e,t){sjs("#sjPopup").text(e.response.msg).show(!0).animate("opacity",{start:0,end:1,onEnd:function(e,t){var n=this;(function(n){t.onEnd=function(e){sjs(e).hide()},n.reverse(e,t)}).delay(5,this)}},.5)}),this.hasListeners("displayPath")||this.addListener("displayPath",function(t){var n=t;t=(t||"/").replace(/\/+$/,"").split("/");var r=e.i18n("root"),i=sjs("#sjPath"),s=t.length-1,o=[],u=-1,a="",f=t[s]||r,l=null;i.find("a").each(function(){var e=this.href.substr(this.href.lastIndexOf("#")+1);if(e==n)return l=this,!1});if(!l){while(++u<s)a+=(t[u]||"")+"/",o[o.length]='<a href="#'+sjs.htmlChars(a)+'">'+sjs.htmlChars(t[u]||r)+"</a>";o[o.length]='<a href="#'+sjs.htmlChars(a+(t[u]||"/"))+'" class="act">'+sjs.htmlChars(t[u]||r)+"</a>",i.html("<span>&nbsp;</span>").append("<div />"),setTimeout(function(){i.first().remove(),i.first().html(o.join("&gt;")),i.first().first().setClass("root")},10)}else i.find("a.act").removeClass("act"),sjs(l).setClass("act")}),this},hasListeners:function(e){return!!this.events[e]&&this.events[e].length},clearListeners:function(e){this.events[e]&&(this.events[e]=null)},addListener:function(e,t){return sjs.isFn(t)&&(this.events[e]||(this.events[e]=[]),this.events[e].push(t)),this},notify:function(e){if(this.events[e]&&this.events[e].push){var t=sjs.toList(arguments),n=this.events[e],r=n.length;t.shift();while(r--)n[r].apply(this,t)}return this},isActionEnabled:function(e){var t=sjs(e),n=!1;this.makeStek();var r=(this.dirStek||[]).length,i=(this.fileStek||[]).length;return n=!t.hasClass("sjsFMdisabled")&&(r&&!i&&!t.hasClass("onlyFile")||i&&!r&&!t.hasClass("onlyDir")||i&&r&&!t.hasClass("onlyDir")&&!t.hasClass("onlyFile")||!t.hasClass("sjsFMdinamic")||this.requestData.files),n},_turnAction:function(e,t){e.push||(e=[e]);var n=e.length,r=t?"show":"hide";while(n--)this.getActionButton(e[n])[r]();return this},disable:function(e){return this._turnAction(e,!1)},enable:function(e){return this._turnAction(e,!0)},hasAction:function(e){return sjs.isFn(this[e+"Action"])},doAction:function(e){if(!this.hasAction(e)||e=="do"||e=="has"||e=="add")return!1;var t=Array.prototype.slice.call(arguments,1);return this.notify(e,t),this[e+"Action"].apply(this,t||[]),this},addAction:function(e,t,n){var r=this.getActionButton(e);if(!r.item(0)){var i={"class":[]};i.name=e;switch(t["for"]){case"files":i["class"].push("onlyFile");break;case"dirs":i["class"].push("onlyDir")}t.dynamic&&i["class"].push("sjsFMdinamic"),"enabled"in t&&!t.enabled&&i["class"].push("sjsFMdisable"),"class"in t&&i["class"].push(t["class"]),i["class"]=i["class"].join(" "),r=sjs('<a href="#">&nbsp;</a>').attr(i),t.after?r.insertAfter(this.getActionButton(t.after)):t.before?r.insertBefore(this.getActionButton(t.before)):r.appendTo(this.actionsBlock)}return this[e+"Action"]=n,this},getActionButton:function(e){return this.actionsBlock.find('a[name="'+e+'"]')},prepareActions:function(){this.makeStek();var e=(this.dirStek||[]).length,t=(this.fileStek||[]).length;return t&&e?this.actionsBlock.setClass("enabledGeneralActions").removeClass("enabledDirActions").removeClass("enabledFileActions"):t&&!e?this.actionsBlock.setClass("enabledFileActions").setClass("enabledGeneralActions").removeClass("enabledDirActions"):e&&!t?this.actionsBlock.setClass("enabledDirActions").setClass("enabledGeneralActions").removeClass("enabledFileActions"):this.restoreDefaultActions(),this},restoreDefaultActions:function(){this.actionsBlock.removeClass("enabledGeneralActions").removeClass("enabledDirActions").removeClass("enabledFileActions")},opendirAction:function(e,n,r){r=!!r,r&&this.actionsBlock.setClass("dofileaction"),sjs.query(this.dirUrl,{dirpath:e},t.opendir,1,{line:n,isRefresh:r,fmId:this.id}),this.restoreDefaultActions()},transformAction:function(e){var t=sjs(e.parentNode);t.hasClass("filemanagerfixed")?(t.removeClass("filemanagerfixed"),sjs.className.set(e,"active")):(t.setClass("filemanagerfixed"),sjs.className.remove(e,"active"))},refreshAction:function(e){var t=this.getCurrentPath();this.opendirAction(t.substr(0,t.length-1),this.lastSelected,1)},cutAction:function(e,t){var n=sjs(e.parentNode);this.makeStek(),this.requestData.files=[].concat(this.fileStek,this.dirStek),this.requestData.baseDir=this.getCurrentPath(),this.requestData.onlyCopy=t,n.find('a[name="paste"]').removeClass("sjsFMdisabled").setClass("sjsFMenabled")},copyAction:function(e){this.cutAction(e,!0)},pasteAction:function(e){if(!this.requestData.files||!this.requestData.files.length||!this.requestData.onlyCopy&&this.requestData.baseDir==this.getCurrentPath())return this.actionsBlock.find('a[name="paste"]').setClass("sjsFMdisabled").removeClass("sjsFMenabled"),!1;sjs.query(this.actionUrl,sjs.extend({action:"paste",path:this.getCurrentPath()},this.requestData),t.paste,1,{object_id:this.id})},removeAction:function(t){this.actionsBlock.find("img").setClass("unvisible"),e.createWindow({id:this.id,title:e.i18n("Are you sure you want to permanently delete")+"?",arguments:{action:"remove"}},"confirm")},renameAction:function(e){this.actionsBlock.find("img").setClass("unvisible"),this.makeStek();if(this.emptyStek())return!1;this._setItemName(this.lastSelected.cells[1]).onEvent("blur",t.rename)},_setItemName:function(e){var t=this.dirStek.concat(this.fileStek),n=t[0].lastIndexOf(".");sjs(e).next().css("display","none"),e.setAttribute("colSpan","2");if(n==-1||!n)n=t[0].length;this.getContent().selectable();var r=sjs.htmlChars(t[0]),i=sjs("label",e).html('<input type="text" name="sjsFMnewName" value="'+r+'" title="'+r+'" />').first();return sjs.selectText(i[0],0,n),i[0].focus(),i[0].__file_manage_id=this.id,i.onEvent("keydown",function(e){var t=sjs.event.key(e);if(t.code==13)return this.blur(),!1;if(t.code==27)return this.value=this.title,this.__escape=!0,this.blur(),!1})},downloadAction:function(e){this.actionsBlock.find("img").setClass("unvisible"),sjs.query(this.actionUrl,{action:"download",path:this.getCurrentPath(),files:document.sjs_form},t.base,!0,{object_id:this.id},{loader:"form",method:"POST"})},permsAction:function(t){this.actionsBlock.find("img").setClass("unvisible"),this.makeStek();if(!this.dirStek.length&&!this.fileStek.length)return!1;e.createWindow({id:this.id,title:e.i18n("Permissions"),postData:{action:"perms",files:this.dirStek.concat(this.fileStek),path:this.getCurrentPath()},arguments:{action:"perms"}},null,this.actionUrl)},dirInfoAction:function(t){this.actionsBlock.find("img").setClass("unvisible"),this.makeStek();var n=0;if(this.dirStek||this.fileStek){var n=this.dirStek.concat(this.fileStek);n.length=1}e.createWindow({id:this.id,postData:{files:n,action:"dir_info",path:this.getCurrentPath()}},null,this.actionUrl)},createDirAction:function(n){this.actionsBlock.find("img").setClass("unvisible");var r=e.i18n("untitled folder"),i=this.getRowTemplate("dir"),s=i.find("label.folder").text(r),o=this.getContent().find("td.dir").nth("last");i.find('input[type="checkbox"]').value(r),o&&o.item(0)?i.insertAfter(o[0].parentNode):this.getContent().find("tbody").prepend(i),this.reset().checked(i[0],"selected",!0),this.hasStekChanges=!0,this.prepareActions()._setItemName(s[0].parentNode).onEvent("blur",t.createDir)},uploadAction:function(t){if(!this.uploader)return!1;this.actionsBlock.find("img").setClass("unvisible"),this.getWindow("upload",e.i18n("Upload Files"))},onUploaderReady:function(){var e=this.getFileManager(),t={action:"upload",print_error:!e.uploader.silently,path:e.getCurrentPath()};t[$_Request.prototype.session_name]=$_Request.prototype.getSession(),e&&(e.notify("uploader_ready",t),e.uploader.setPostParams(t))},onUploadSuccess:function(e,t){if(!this.uploader.hasErrors&&this.uploader.getStats().files_queued==0){var n=this.doAction("refresh").getWindow("upload");(function(){n.close()}).delay(.5)}},getWindow:function(t,n){var r=this.windows[t];return r?(r.show().position(),r):(r=e.createWindow({id:this.id,title:n,content:sjs("#sj"+sjs.capitalize(t)+"Tmpl").first()[0],arguments:{action:t}}),r.find(".sjs_wcontent").setClass("sjs_uploader"),r.onclose=function(){return this.hide(),!1},this.windows[t]=r)},setUploader:function(e){return e?(this.uploader=e,e.__file_manager_id=this.id,e.getFileManager=function(){return sjs.globals.fm[this.__file_manager_id]},this.enable("upload")):this.disable("upload"),this},getContent:function(){var e=this.lastSelected.offsetParent;return e||(e=this.lastSelected.parentNode.parentNode),sjs(e.parentNode)}}),t={base:function(e,t){var n=sjs.globals.fm[this.args.object_id];return e&&e.response&&e.response.status=="error"?(n.notify("serverError",e,t),n.actionsBlock.find("img").setClass("unvisible")):(n.notify("serverOk",e,t),n.doAction("refresh"),n.clearStek("file","dir"),n.requestData={}),n},opendir:function(e,t){var n=sjs.globals.fm[this.args.fmId],r;if(e&&e.response&&e.response.status=="error")sjs(this.args.line).find("label").removeClass("loading"),n.notify("serverError",e,t);else{var i=n.getContent().html(t).first().item(0);r=n.getCurrentPath(i),this.args.isRefresh?n.actionsBlock.removeClass("dofileaction"):n.displayFullPath(r)}},paste:function(e,n){var r=t.base.call(this,e,n);e.response.status!="error"&&r.actionsBlock.find('a[name="paste"]').setClass("sjsFMdisabled").removeClass("sjsFMenabled")},remove:function(e,n,r,i){this.actionsBlock.find("img").removeClass("unvisible"),e.onEvent("click",function(e){var n=sjs.event.caller(e),r=2;while(!sjs.nodeName(n,"button")&&r--)n=n.parentNode;if(!sjs.nodeName(n,"button"))return!1;var i=sjs.globals.fm[this.__file_manager_id],s=sjs.globals.windows[this.__window_id];t.processButtons(n,i,{action:"remove",files:i.fileStek.concat(i.dirStek)}),this.onclick=null,s.close(e,n)}),e[0].__file_manager_id=this.id,e[0].__window_id=i.id},perms:function(e,n,r,i){var s=e.onEvent("click",function(e){var n=sjs.event.caller(e),r=sjs.globals.fm[this.__file_manager_id],i=sjs.globals.windows[this.__window_id];if(!sjs.nodeName(n,"input")&&!sjs.nodeName(n,"button")&&(!sjs.nodeName(n,"span")||!sjs.nodeName(n=n.parentNode,"button")))return!0;var s=n.form["perms[value]"];if(n.type=="checkbox"){if(isNaN(Number(s.value)))return!1;n.checked?s.value=Number(s.value)+Number(n.value):s.value=Number(s.value)-Number(n.value)}else sjs.nodeName(n,"button")&&(t.processButtons(n,r,{action:"perms",fileperms:s.value,send:s.value!=s.title,files:r.fileStek.concat(r.dirStek)}),this.onclick=null,i.close(e,n))}).find("input[type=text]").onEvent("keyup",function(){if(!isNaN(Number(this.value))){var e=null,t=new Array("own","gr","oth"),n=this.value.trim();for(var r=0;r<3;r++)e=Number(n.charAt(r))||0,e>=4?(this.form["perms["+t[r]+"_read]"].checked=1,e-=4):this.form["perms["+t[r]+"_read]"].checked=0,e>=2?(this.form["perms["+t[r]+"_write]"].checked=1,e-=2):this.form["perms["+t[r]+"_write]"].checked=0,e>=1?this.form["perms["+t[r]+"_exec]"].checked=1:this.form["perms["+t[r]+"_exec]"].checked=0;e=t=n=null}});e[0].__file_manager_id=this.id,e[0].__window_id=i.id,s.trigger("keyup"),s[0].title=s[0].value},createDir:function(e,n,r,i){var s=sjs.globals.fm[this.__file_manage_id],o=sjs.trim(this.value);s.getContent().unselectable();if(this.__escape||!o){s.findLastSelected(s.getContent().first()[0]);var u=this.parentNode.parentNode.parentNode;u.parentNode.removeChild(u)}else sjs.query(s.actionUrl,{path:s.getCurrentPath(),action:"create_dir",dirname:o},t.base,1,{object_id:s.id});s.reset()},rename:function(e){var n=sjs.globals.fm[this.__file_manage_id],r=n.dirStek.concat(n.fileStek);n.getContent().unselectable(),this.value=String(this.value).trim();if(!this.value||this.value==this.title){var i=this.parentNode.parentNode,s=r[0].lastIndexOf(".");return filename=this.title,s&&s!=-1&&(filename=filename.substr(0,s)),sjs(i).attr("colSpan",1).next().css("display",""),sjs(this.parentNode).html(sjs.htmlChars(filename)),!1}n.actionsBlock.find("img").removeClass("unvisible"),sjs.query(n.actionUrl,{files:r,fileNames:[this.value],action:"rename",path:n.getCurrentPath()},t.base,!0,{object_id:n.id})},upload:function(e,t,n,r){var i=e.find('button[name="upload"]').onEvent("click",function(){var e=sjs.globals.fm[this.__file_manager_id];e.uploader.startUpload()});i[0].__file_manager_id=this.id},processButtons:function(e,n,r,i){var s=e.name,o=!0;"send"in r&&(o=r.send,delete r.send);switch(s){case"ok":if(!o)return!1;n.makeStek(),sjs.query(n.actionUrl,sjs.extend({path:n.getCurrentPath()},r||{}),sjs.isFn(i)&&i||t.base,1,{object_id:n.id}
);break;default:n.actionsBlock.find("img").setClass("unvisible")}}};e.createWindow=function(n,r,i,s){r&&(n.content=sjs("#sj"+sjs.capitalize(r)+"Tmpl")[0].innerHTML),n.arguments?n.arguments.file_manage_id=n.id:n.arguments={file_manage_id:n.id};var o=new sjWindow(i,sjs.extend({title:e.i18n("Information"),tmpl:"#sjWindowTmpl",isModal:!0,action:"001",onChangeSize:function(e){var t=e.getSize();sjs(this.window).css("width",t.width+t.margin[1]+t.margin[3]+"px")}},n||{}),function(e,n,r){var i=sjs.globals.fm[this.arguments.file_manage_id],s=t[this.arguments.action];if(n&&n.response&&n.response.status=="error")return i.notify("serverError",n,r),this.close();sjs.isFn(s)&&s.call(i,e,n,r,this),this.position()});return o};var n={data:{},_value:function(e,t){var n=e.split("."),r=n.length-1,i=this.data;for(var s=0;s<r;s++)i[n[s]]||(i[n[s]]={}),i=i[n[s]];if(t==undefined)return i[n[s]];i[n[s]]=t},set:function(e,t,n){return t=t==undefined?n:t,e.indexOf(".")!=-1?this._value(e,t):this.data[e]=t,this},get:function(e,t){var n;return e.indexOf(".")!=-1?n=this._value(e):n=this.data[e],n||t},clear:function(){this.data={}}};n.set("fm.listeners.ready",[]).set("fm.listeners.displayPath",[]).set("fm.listeners.serverError",[]).set("fm.listeners.serverOk",[]).set("fm.listeners.click",[]).set("fm.listeners.dblclick",[]).set("fm.listeners.uploader_ready",[]),e.configure=function(t){t.i18n&&this.i18n(t.i18n);var r=sjs.trim(t.url)+"?tmpl=window&show_actions=1";return t.opendir&&(r+="&dirpath="+t.opendir),n.set("url",r).set("fm.container",t.container,"#sjFilemanager").set("fm.rootUrl",t.root).set("fm.actionUrl",sjs.trim(t.url)).set("fm.files_per_page",t.files_per_page,100),t.window=t.window||{},n.set("window.tmpl","#sjWindowTmpl").set("window.title",e.i18n("File Manager")).set("window.isModal",t.window.isModal,!0).set("window.action",t.window.action,"001").set("window.move",t.window.movable,!0).set("window.resizable",t.window.resizable,!0),n};var r=new sjs.promise;e.getInstance=function(){if(r instanceof e)return r.getWindow("main").show().position(),r.reset(),r;if(!n.get("window")||!n.get("url")||!n.get("fm"))throw"sjFilemanager was not configured. Use sjFilemanager.configure method!";var t=new sjWindow(n.get("url"),n.get("window"),function(t,i,s){var o=sjs(n.get("fm.container"));if(!o.length)throw r.reject(),"Config 'fm.container' does not match any DOM element. Maybe the problem with server response";var u=new e(o,n.get("fm"),n.get("fm.listeners"));u.windows.main=this,n.clear(),r.resolve(u),r=u,this.position().toInnerSize(),sjs.className.set(this.window,"sjFilemanagerWindow"),sjs.className.set(this.clone,"sjFilemanagerWindow")});return sjs(t.window).removeClass("ie6_width_fix").find(".sjs_wcontent").setClass("sjDimensions"),t.onclose=function(){return this.hide(),!1},r};var i={exportToField:function(e,t){this.makeStek();if(this.fileStek&&this.fileStek.length){var n=this.rootUrl+this.getCurrentPath();e.sjs||(e=sjs(e));switch(t){case"multiple":e.prop("value",n+"|"+this.fileStek.join(":"));break;default:e.prop("value",n+this.fileStek[0])}e.trigger("change"),this.windows.main.close()}}};e.choiseCallback=function(t,n){return sjs.when(e.getInstance(),function(e){path=String(t.value).replace(e.rootUrl,""),path&&e.open(path.charAt(path.length-1)=="/"?path:sjs.pathinfo(path).dirname),e.addAction("insert",{before:"refresh",dynamic:!0,"class":"sjfm_files_insert","for":"files"},i.exportToField.bind(e,t,n))})},window.sjFileManager=e}(),sjFileManager.get=function(e){return!e||!e.__FileManageId__?null:sjs.globals.fm[e.__FileManageId__]},sjFileManager.link=function(e,t){return e?e.__FileManageId__=t:null},sjFileManager.tr={},sjFileManager.i18n=function(e){if(e.constructor==String)return this.tr[e]?this.tr[e]:e;this.tr=e},sjFileManager.getUploader=function(e,t){var n=e.charAt(e.length-1)=="/"?e:sjs.pathinfo(e).dirname;return new SWFUpload(sjs.extend({upload_url:e,flash_url:n+"/js/swfupload/swfupload.swf",file_post_name:"files",custom_settings:{progressTarget:"sjFmUploadProgress"},file_size_limit:"300MB",file_types:"*.*",file_types_description:"All Files",file_upload_limit:100,file_queue_limit:0,button_text_left_padding:5,button_text_top_padding:1,button_image_url:n+"/js/swfupload/sbtn.png",button_placeholder_id:"sjFmButtonPlaceHolder",button_text:'<span class="submit">'+sjFileManager.i18n("Files")+"</span>",button_width:"65",button_text_style:".submit { font-size: 11; color:#000000; font-family:Tahoma, Arial, serif; }",button_height:"20",file_queued_handler:fileQueued,file_queue_error_handler:fileQueueError,file_dialog_complete_handler:sjFileManager.prototype.onUploaderReady,upload_start_handler:uploadStart,upload_progress_handler:uploadProgress,upload_error_handler:uploadError,upload_success_handler:function(e,t){t&&(this.hasErrors=!0),uploadSuccess.call(this,e,t);var n=this.getFileManager();n&&n.onUploadSuccess(e,t)}},t||{}))},sjFileManager.create=function(e){sjWindow.renderView(),MediaManager.renderView(e.i18n);var t=sjFileManager.configure(e);return t.get("fm.listeners.ready").push(function(){var e=this,n=sjFileManager.getUploader(t.get("url"),t.get("fm.uploader"));this.setUploader(n);var r=sjs("#sjMediamanager").insertBefore("#sjWrapper").find(".sjMediaWrapper");MediaManager.getInstance(r,{panel:".sjMediaPanel",lazy:!0,saveUrl:t.get("url")}).syncWithFileManager(e,"refresh").addListener("serverOk",function(t,n){this.unsFiles(t.media.rm),this.addFiles(t.media.add),this.gotoFile(this.files.length-t.media.add.length),e.doAction("refresh")})}),t.get("fm.listeners.click").push(function(){var e=MediaManager.getInstance(),t;this.makeStek(),!e.isSleepy&&(t=this.getFiles())&&e.setFiles(t).showFile()}),t.get("fm.listeners.dblclick").push(function(e){sjs("td.dir",e).length||this.doAction("insert")}),t.get("fm.listeners.ready").push(function(e){var n=new sjs.ScrollableContent(e.parent(2),{url:t.get("fm.actionUrl"),page:2,data:{format:"json"}}),r=this;n.on("load",function(e){var t=e.js;if(t.files&&t.files.source){var n=t.files.source;for(var i=0,s=n.length;i<s;i++){var o=n[i];o.type=o.is_dir?"dir":o.type,r.addRow(o)}n.length&&e.loader.page++}}).on("data",function(e){e.dirpath=r.getCurrentPath()})}),t.set("fm.liseners.opendir",[]).get("fm.liseners.opendir").push(function(){scr.clearCache()}),t},sjs.globals.mm={};var MediaManager=new sjs.plugin({__construct:function(e,t){this.body=e,this.panel=t&&t.panel&&e.parent().find(t.panel||".sjMediaPanel"),this.id=this.body.getObjectId(),this.files=t&&t.files||[],this.index=0,this.mode=t&&t.mode||"preview",this.layer=null,this.saveUrl=(t.saveUrl||"").replace(/[\\\/]+$/,"")+"/",this.isActive=!1,this.isBusy=!1,this.isSleepy=!0,this.listeners={},this.currentFileType="",this.activeAction=null,this.loadingMask=null,t.lazy||this.initialize(),sjs('<span class="vmiddle-fix">&nbsp;</span>').insertAfter(this.body).unselectable(),sjs.globals.mm[this.id]=this},__destruct:function(){this.layer=this.loadingMask=null,this.panel=this.body=this.files=null},reset:function(){return this.body.parent().css("minHeight","").parent().removeClass("fixMediaManager"),this.getContent().resetStyle(),this.resetDrawLayer().getToolbar(":active").hide(),this.getLining().hide(),this.activeAction=null,this.isBusy=!1,this.panel.find('*[name="save"]').setClass("sjDisabled"),this},isFrosen:function(){return this.activeAction=="save"},initialize:function(){this.isActive=!0,this.isSleepy=!1,this.setMode(this.mode);if(!this.panel)return!1;this.panel.click(function(e,t){var n=sjs.event.caller(e);if(!sjs.nodeName(n,"a"))return!0;var r=sjs.globals.mm[t];r.processHandler(n.name,n,e),sjs.event.preventDefault(e)},this.id),this.body.unselectable();var e=this.id;return this.panel.unselectable().onEvent("keydown",function(e){var t=sjs.event.caller(e);if(!sjs.nodeName(t,"input"))return!0;sjs.event.key(e).code==13&&sjs(t).trigger("change")}).find('input[type="text"]').focus(function(){sjs(this).data("value",this.value),MediaManager.get(e).panel.selectable()}).blur(function(){MediaManager.get(e).panel.unselectable()}),this.addStandardHandlers(),this},addStandardHandlers:function(){return this.listeners?(sjs.isFn(this.listeners.serverError)||this.addListener("serverError",function(e,t){sjs("#sjPopup").text(e.response.msg).show(!0).animate("opacity",{start:0,end:1,onEnd:function(e,t){(function(n){t.onEnd=function(e){sjs(e).hide()},n.reverse(e,t)}).delay(5,this)}},.5)}),sjs.isFn(this.listeners.serverOk)||this.addListener("serverOk",function(e,t){this.unsFiles(e.media.rm),this.addFiles(e.media.add),this.gotoFile(this.files.length-e.media.add.length)}),this):this},wakeupResizeToolbar:function(e,t,n){if(e.data("isInit"))return this;e.data("isInit",!0),typeof n=="undefined"&&(n=!0);var r=this.id,i=e.find('input[type="text"]');return i.onEvent("change",function(e){this.value=MediaManager.get(r).filterToolbarValue(this,t,n)}),this},wakeupCropToolbar:function(e){return this.wakeupResizeToolbar(e,!0,!1)},wakeupSaveToolbar:function(e){if(e.data("isInit"))return this;e.data("isInit",!0);var t=sjs.pathinfo(this.currentFile()),n=0,r=this.id;return n=e.find('input[name="file"]').value(t.basename).onEvent("change",function(){var e=sjs.trim(this.value);e||(e=sjs(this).data("value")),this.value=e}).item(0),e.mousedown(function(e){var t=sjs.event.caller(e);if(!sjs.nodeName(t,"a"))return!0;sjs.event.preventDefault(e);var n=MediaManager.get(r),i="_"+t.name+"Changes";sjs.isFn(n[i])&&(n[i](sjs(this).data("action")),n.notify(t.name+"Changes",this,t))}),this},filterToolbarValue:function(e,t,n){var r=Number(e.value)||0,i=this.getToolbar(":active"),s=i.find('input[type="checkbox"]').item(0),o=this.body.width(),u=this.body.height(),a=this.getDrawLayer().width(),f=this.getDrawLayer().height(),l={};if(r<0||(e.name=="width"||e.name=="height")&&r==0)r=Number(sjs(e).data("value"))||1;if(t)switch(e.name){case"left":r+a>o&&(r=o-a);break;case"top":r+f>u&&(r=u-f);break;case"width":r>o&&(r=o);break;case"height":r>u&&(r=u)}r=r.round(2);if(s&&s.checked){var c=a/f;e.name=="height"?(l.width=(r*c).round(2),i.find('input[name="width"]').value(l.width)):e.name=="width"&&(l.height=(r/c).round(2),i.find('input[name="height"]').value(l.height))}l[e.name]=r,this.setDrawLayerSize(l);if(n){var h=this.getLayerBody();h.first().width(h.width()).height(h.height()),this.applyChanges()}return r},getContent:function(){return this.body.first().hasClass("sjMediaContent")||this.body.prepend('<div class="sjMediaContent" />'),this.body.first()},applyChanges:function(){var e=this.getLayerBody();return this.updateContent().getContent().css({overflow:sjs.css(e.item(0),"overflow")||""}),this.body.width(this.getDrawLayer().width()).height(this.getDrawLayer().height()),this},updateContent:function(){var e=this.getLayerBody(),t=e.first();return this.getContent().css({width:e.width()+"px",height:e.height()+"px"}).first().css({width:t.width()+"px",height:t.height()+"px",marginTop:sjs.css(t.item(0),"top")||"",marginLeft:sjs.css(t.item(0),"left")||""}),this},getLining:function(){return this.body.find("div.sjLining").length||sjs('<div class="sjLining" />').insertAfter(this.getContent()).css({position:"absolute",top:"0px",left:"0px",display:"none"}),this.getContent().next().width(this.body.width()).height(this.body.height())},resetDrawLayer:function(){return this.layer?(sjs.isFn(this["__begin"+this.activeAction])&&this.layer.unlinkEvent("mousedown",this["__begin"+this.activeAction]),this.layer.resetStyle().hide(),this.getLayerBody().resetStyle().first().resetStyle(),this):this},updateDrawLayer:function(e){return!this.layer||!e&&!this.layer.width()?this:(this.getLayerBody().html(this.getContent().html()),this.getDrawLayer().width(this.body.width()).height(this.body.height()),this)},getDrawLayer:function(){if(!this.layer){var e="",t=["n","s","e","w","ne","nw","se","sw"],n=t.length;while(n--)e+='<span class="sjsResize '+t[n]+'" id="'+t[n]+'"></span>';this.layer=sjs('<div class="sjMediaLayer" />').hide().append('<div class="sjMediaHolder" />').append('<div class="sjsResizable" />').last().html(e).parent().appendTo(this.body),MediaManager.link(this.layer.item(0),this.id)}return this.layer},getLayerBody:function(){return this.getDrawLayer().first()},getResizeTools:function(){return this.getDrawLayer().first().next()},getToolbar:function(e,t){return t=t?" "+t:"",e==":active"?this.panel.find("div.tools:visible"+t):this.panel.find("div."+e+"Tools"+t)},getLoadingMask:function(){return this.loadingMask||(this.loadingMask=sjs('<div class="loading-mask" />').appendTo(this.body.parent())),this.loadingMask},waiting:function(e){var t=this.getLoadingMask();return e?t.show(!0):t.hide(),this},notify:function(e){if(sjs.isFn(this.listeners[e])){var t=sjs.toList(arguments);t.shift(),this.listeners[e].apply(this,t)}return this},attachListeners:function(e){return this.listeners=e,this},addListener:function(e,t){return sjs.isFn(t)&&(this.listeners[e]=t),this},setActiveAction:function(e,t){return this.panel.find(".active").removeClass("active"),t?sjs(t).setClass("active"):this.panel.find('*[name="'+e+'"]').setClass("active"),this.panel.find('.sjDisabled[name="save"]').removeClass("sjDisabled"),this.activeAction=e,this},disableAction:function(e,t){return t?sjs(t).setClass("sjDisabled"):this.panel.find('*[name="'+e+'"]').setClass("sjDisabled"),this},setMode:function(e){return this.body.parent().removeClass("sj"+sjs.capitalize(this.mode)+"Mode").setClass("sj"+sjs.capitalize(e)+"Mode"),this.mode=e,this.notify("changeMode",e),this},preparePanel:function(e){e&&this.panel.removeClass("sj"+sjs.capitalize(e)+"Type"),this.panel.setClass("sj"+sjs.capitalize(this.currentFileType)+"Type");var t=this.panel.find(".nav");if(this.isLastFile())if(this.files.length<=1)t.hide();else{var n=t.item(1).name=="prev"&&1||0;t.removeClass("sjDisabled").show(),this.index==0?t.nth(n).setClass("sjDisabled"):this.index==this.files.length-1&&t.nth(Number(!n)).setClass("sjDisabled")}else t.removeClass("sjDisabled");var r=this.panel.find('*[name="save"]');return this.activeAction?r.removeClass("sjDisabled"):r.setClass("sjDisabled"),this},setPanelVisibility:function(e){if(!this.panel||!this.panel.length)return!1;var t=this.panel.item(0),n=0;return e?n=this.panel.data("oldTop"):(this.panel.data("oldTop")||this.panel.data("oldTop",t.offsetTop),n=-t.offsetHeight-10),this.panel.animate("top",{start:t.offsetTop,end:n},.2),this},setFiles:function(e){return this.files=e,this.index=0,this},addFiles:function(e){return e.constructor==Array?this.files=this.files.concat(e):this.files.push(e),this},unsFiles:function(e){if(!e)return this;e.constructor!=Array&&(e=[e]);var t=this.files.length,n={},r=e.length,i="";while(t--)n[this.files[t].replace(/\/+$/,"")]=t;while(r--)i=e[r].replace(/\/+$/,""),i in n&&this.files.splice(n[i],1);return this},getMediaHtml:function(){var e=this.currentFile(),t="",n=e.substr(e.lastIndexOf(".")+1).toLowerCase();return n=="jpg"||n=="jpeg"||n=="gif"||n=="png"?(t+='<img src="'+sjs.htmlChars(e)+"?"+ +(new Date)+'" />',this.currentFileType="image"):n=="swf"?(t='<object align="middle" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0" >',t+='    <param value="opaque" name="wmode"/>',t+='    <param value="'+sjs.htmlChars(e)+'" name="movie"/>',t+='    <param value="always" name="AllowScriptAccess"/>',t+='    <param value="high" name="quality"/>',t+='    <embed align="middle" ',t+='    pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" allowscriptaccess="always" wmode="opaque" quality="high" src="'+e+'"/>',t+="</object>",this.currentFileType="flash"):(t='<div class="unknown-file"></div>',this.currentFileType="unknown"),t},__mediaLoadingEvent:function(e,t){var n=MediaManager.get(e.item(0));n.currentFileType!="unknown"&&(!e.width()||n.currentFileType=="image"&&e.item(0).complete!=1)?sjs.browser.msie||sjs.browser.opera||n.currentFileType!="image"?arguments.callee.delay(.1,e,t):e.onEvent("load",t):t.call(e.item(0))},getMediaContent:function(e){var t=sjs(e),n=0;switch(this.currentFileType){case"flash":}return t},__onFileReady:function(e){var t=MediaManager.get(this).waiting(!1);t.prepareLayers(t.getMediaContent(this))},prepareLayers:function(e){var t=e.width(),n=e.height();return this.layer&&(this.resetDrawLayer().getContent().resetStyle(),this.getToolbar(":active").hide()),this.getLining().hide(),this.currentFileType=="image"?(this.body.width(t).height(n),e.width(t).height(n)):this.body.width("auto").height("auto"),this.activeAction=null,this},currentFile:function(){return this.files[this.index]},nextFile:function(){return this.gotoFile(this.index+1)},prevFile:function(){return this.gotoFile(this.index-1)},isLastFile:function(e){return e=e||this.index,e==0||e==this.files.length-1},gotoFile:function(e){if(e>=this.files.length||e<0)return!1;this.index=e;var t=this.currentFileType,n=this.getMediaHtml(),r=null;return r=this.getMediaContent(this.getContent().html(n).first()),r.length?(MediaManager.link(r.item(0),this.id),this.waiting(!0),this.__mediaLoadingEvent(r,this.__onFileReady),this.preparePanel(t)):this},showFile:function(){return this.gotoFile(0),this},setIsSleepy:function(e){return this.notify("changeState",e),this.isSleepy=e,this},processHandler:function(e,t,n){var r=e+"Action";if(!this.isSleepy&&sjs.isFn(this[r])&&!sjs.className.has(t,"sjDisabled")&&t.offsetWidth){var i="wakeup"+sjs.capitalize(e)+"Toolbar",s=this.getToolbar(e);sjs.isFn(this[i])&&(this.getToolbar(":active").hide(),this[i](s.show(!0))),this[r](t,n,s),this.notify(e,t,n,s)}return this},lazyWakeUp:function(e){var t=MediaManager.get(e),n=null,r=sjs(e),i=t.body.parent().parent();r.hasClass("active")?(r.removeClass("active"),t.processHandler("halt",e)):(r.setClass("active"),t.setIsSleepy(!1).display(!0,{width:[10,parseInt(i.width()/2)],height:[0,i.height()-4],opacity:[0,1]}),this.getFiles&&(n=this.getFiles())&&t.setFiles(this.getFiles()).showFile()),t.isActive||t.initialize()},haltAction:function(){return this.setIsSleepy(!0).setMode("preview").reset(),this.display(!1,function(e,t){sjs(e).hide()})},changemodeAction:function(){var e="",t=this.body.parent().parent(),n=0,r=null;this.mode=="preview"?(e="full",n=t.width()-4,r=function(e){var t=sjs(e);t.css("minHeight",t.height()+"px").parent().setClass("fixMediaManager")}):(e="preview",n=t.width()/2,this.reset()),this.setMode(e).display(!0,{width:[this.body.parent().width(),n],height:[this.body.parent().height(),t.height()-4],opacity:[1,1]},r)},resizeAction:function(e,t,n){if(this.currentFileType!="image"||"resize"==this.activeAction)return!1;this.setActiveAction("resize",e),this.getDrawLayer(),this.resetDrawLayer().updateDrawLayer(!0).getLining().hide(),this.layer.show(!0).onEvent("mousedown",this.__beginResize),sjs.browser.msie||this.getLayerBody().css("opacity",.5);var r=n.find("input");r.item(0).value=this.body.width(),r.item(1).value=this.body.height()},__beginResize:function(e){var t=sjs.event.caller(e);if(!sjs.className.has(t,"sjsResize"))return!0;var n=MediaManager.get(this);if(n.isFrosen())return!0;var r=n.getToolbar(":active",'input[type="checkbox"]').item(0);n.setResizable(this,{type:t.id,proportions:r&&r.checked,onEnd:function(e){var t=MediaManager.get(e);t.setPanelVisibility(!0),t.getDrawLayer().css({top:"",left:"",right:"",bottom:""})}}).setPanelVisibility(!1)},cropAction:function(e,t,n){if(this.currentFileType!="image"||"crop"==this.activeAction)return!1;this.setActiveAction("crop",e),this.isBusy=!0,this.getDrawLayer(),this.resetDrawLayer().updateDrawLayer(!0).getLining().show(!0),this.layer.show(!0);var r=this.layer.width()/2,i=this.layer.height()/2;this.setDrawLayerSize({width:r,height:i,left:r/2,top:i/2}).getLayerBody().css({overflow:"hidden",cursor:"move"}),this.layer.onEvent("mousedown",this.__beginCrop);var s=n.find("input");s.item(0).value=i/2,s.item(1).value=r/2,s.item(2).value=r,s.item(3).value=i},__beginCrop:function(e){var t=sjs.event.xy(e),n=sjs.event.caller(e),r=MediaManager.get(this);sjs.event.preventDefault(e);if(r.isFrosen())return!1;r.setCropable(this,{type:sjs.className.has(n,"sjsResize")&&n.id,x:t.x-this.offsetLeft,y:t.y-this.offsetTop,proportions:r.getToolbar(":active",'input[type="checkbox"]').item(0).checked,onEnd:function(){var e=MediaManager.get(this),t=e.getToolbar(":active","input");t.item(0).value=this.offsetTop,t.item(1).value=this.offsetLeft,t.item(2).value=this.offsetWidth,t.item(3).value=this.offsetHeight,e.setPanelVisibility(!0)}}).setPanelVisibility(!1)},nextAction:function(e){this.nextFile()},prevAction:function(e){this.prevFile()},saveAction:function(e,t,n){if(this.currentFileType!="image"||"save"==this.activeAction)return!1;n.data("action",this.activeAction),this.setActiveAction("save",e);var r=this.getLining(),i=sjs.pathinfo(this.currentFile()),s=i.basename.lastIndexOf(".");n.data("showLining",!!r.width());var o=n.find('input[name="file"]').value(i.basename).item(0);if(!s||s==-1)s=i.basename.length;o.focus(),sjs.selectText(o,0,s);if(n.data("isActive"))return!0;n.data("isActive",!0),n.onEvent("click",function(e){var t=sjs.event.caller(e);if(!sjs.nodeName(t,"a")||sjs.className.has(this,"disabledBar"))return!0;var n=MediaManager.get(this),r="_"+t.name.toLowerCase()+"Changes";if(!sjs.isFn(n[r]))return!0;sjs(this).setClass("disabledBar"),n[r](sjs(this).data("action"),n.currentFile()),sjs.event.stopPropagation(e),sjs.event.preventDefault(e)}),MediaManager.link(n.item(0),this.id)},_syncChanges:function(e,t){var n=this.getToolbar(e),r={};n.find('input[type="text"], textarea, input:checked').iterate(function(){r[this.name]=this.value});var i=this.getToolbar("save").find("input"),s=sjs.pathinfo(this.currentFile());i[0].value=sjs.trim(i[0].value||s.basename),r.action=e,r.files={},r.files[this.currentFile()]=i[0].value,r.override=i[1].checked,this._sendRequest(r)},_cancelChanges:function(e,t){var n=this.getToolbar("save").hide();this.getToolbar(e).show(!0),this.setActiveAction(e),n.data("showLining")&&this.getLining().show(!0),n.removeClass("disabledBar")},_sendRequest:function(e){e.manager_type="media",this.notify("sendRequest",e),this.waiting(!0),sjs.query(this.saveUrl,e,function(e,t){var n=this.args.mm;n.waiting(!1),e&&e.response.status=="error"?n.notify("serverError",e,t):n.notify("serverOk",e,t),n.getToolbar("save").removeClass("disabledBar"),n.disableAction("save")},1,{mm:this})},display:function(e,t,n){var r=this.body.parent().css("overflow","hidden"),i={height:{},width:{},opacity:{}};return e?(i.width.start=t.width[0]||1,i.width.end=t.width[1],i.height.start=t.height[0],i.height.end=t.height[1],i.opacity.start=t.opacity[0],i.opacity.end=t.opacity[1],r.css("lineHeight",i.height.end+"px").show(!0)):(i.width.start=r.width(),i.width.end=0,i.height.start=r.height(),i.height.end=0,i.opacity.start=1,i.opacity.end=0,n=t),r.animate("width",{start:i.width.start,end:i.width.end,onEnd:n},1).animate("height",{style:"~bounce",start:i.height.start,end:i.height.end,onEnd:function(e){sjs(e).css("overflow","auto")}},2).animate("opacity",{start:i.opacity.start,end:i.opacity.end},1),this},setResizable:function(e,t){t=t||{},MediaManager.link(t,this.id);var n=sjs.getPosition(e),r=sjs.startResize(e,sjs.extend({_x:-n.left,_y:-n.top,onResize:function(e,t,n){var r=MediaManager.get(n);r.getLayerBody().width(e).height(t).first().width(e).height(t)},onResizeEnd:function(e){var t=MediaManager.get(e),n=sjs(this),r=t.getToolbar(":active",'input[type="text"]'),i=n.width(),s=n.height();r.item(0).value=i,r.item(1).value=s,t.applyChanges(),sjs.isFn(e.onEnd)&&e.onEnd.call(this,e)}},t));return sjs(document).mouseup(sjs.stopResize,r),this},setCropable:function(e,t){var n=function(e){sjs.isFn(e.data.onEnd)&&e.data.onEnd.call(this),this.__cropObject=null};e.__cropObject=this.getLayerBody().first();if(t.type){var r=sjs.getPosition(e.parentNode),i=sjs.startResize(e,{_x:-r.left,_y:-r.top,selection:!0,proportions:t.proportions,type:t.type,parentOffset:!0,onResize:function(e,t,n){this.__cropObject.parent().height(t).width(e),this.__cropObject.css({top:-this.offsetTop+"px",left:-this.offsetLeft+"px"})},onResizeEnd:n,data:t});sjs(document).mouseup(sjs.stopResize,i)}else{var s=sjs.startDrag(e,{_x:t.x,_y:t.y,type:"parentOffset",onMove:function(e,t){this.__cropObject.css({top:-t+"px",left:-e+"px"})},onDragEnd:n,data:t});sjs(document).mouseup(sjs.stopDrag,s)}return this},setDrawLayerSize:function(e){var t=this.getLayerBody();return typeof e.width!="undefined"&&(t.width(e.width),this.getDrawLayer().width(t.width())),typeof e.height!="undefined"&&(t.height(e.height),this.getDrawLayer().height(t.height())),typeof e.left!="undefined"&&(this.getDrawLayer().css("left",e.left+"px"),t.first().css("left",-e.left+"px")),typeof e.top!="undefined"&&(this.getDrawLayer().css("top",e.top+"px"),t.first().css("top",-e.top+"px")),this},syncWithFileManager:function(e,t){var n=this.lazyWakeUp,r=this.id,i;return e.addAction("openMedia",{"for":"files",dynamic:!0,"class":"showMediaManager",after:t},function(e){i=e,MediaManager.link(e,r),n.call(this,e)}),this.attachListeners({changeState:function(e){var t=sjs(i);e&&t.hasClass("active")&&t.removeClass("active")}}),this}});MediaManager.get=function(e){var t=Number(e)||e.__media_manager_id;return t?sjs.globals.mm[t]:null},MediaManager.link=function(e,t){return!e||!t?!1:(e.__media_manager_id=t,!0)},MediaManager.getInstance=function(e,t){return this.instance?this.instance:(this.instance=new MediaManager(e,t),this.instance)},MediaManager.renderView=function(e){var e=sjs.extend({Top:"Top",Left:"Left",Width:"Width",Height:"Height",Proportions:"Proportions","File Name":"File Name","Override File":"Override File","Apply for All":"Apply for All"},e||{}),t=sjs('<div id="sjMediamanager" />').append('<div class="sjMediaPanel" />').append('<div class="sjMediaWrapper" />'),n=t.first().append('<a href="#" name="prev" class="prev nav" />').append('<a href="#" name="next" class="next nav" />').append('<a href="#" name="crop" class="imageOnly forFullMode crop" />').append('<a href="#" name="resize" class="imageOnly forFullMode resize" />').append('<a href="#" name="save" class="imageOnly forFullMode save" />').append('<a href="#" name="changemode" class="changeMode" />').append('<a href="#" name="halt" class="halt" />').append('<div class="sjMediaTools" />').last().append('<div class="cropTools tools" />').append('<div class="resizeTools tools" />').append('<div class="saveTools tools" />'),r=n.first().append('<label for="crop_y" class="top">'+e.Top+": </label>").append('<input type="text"class="text top" name="top" id="crop_y" />').append('<label for="crop_x" class="left">'+e.Left+": </label>").append('<input type="text" class="text left" name="left" id="crop_x" />').append('<label for="crop_w" class="width">'+e.Width+": </label>").append('<input type="text" class="text width" name="width" id="crop_w" />').append('<label for="crop_h" class="height">'+e.Height+": </label>").append('<input type="text" class="text height" name="height" id="crop_h" />').append('<input type="checkbox" value="1" class="checkbox prop" name="crop_prop" id="crop_prop" />').append('<label for="crop_prop" class="prop">'+e.Proportions+"</label>").next().append('<label for="resize_w" class="width">'+e.Width+": </label>").append('<input type="text" class="text width" name="width" id="resize_w" />').append('<label for="resize_h" class="height">'+e.Height+": </label>").append('<input type="text" class="text height" name="height" id="resize_h" />').append('<input type="checkbox" checked="checked" value="1" class="checkbox prop" name="crop_prop" id="resize_prop" />').append('<label for="resize_prop" class="prop">'+e.Proportions+"</label>").next().append('<label for="file" class="file">'+e["File Name"]+": </label>").append('<input type="text" class="text file" name="file" id="file" />').append('<span class="v-wrap"></span>').append('<a href="#" name="sync" class="apply" />').append('<a href="#" name="cancel" class="cancel" />');return r.find("span.v-wrap").append('<input type="checkbox" id="save_ovr" name="override" class="checkbox prop " value="1" checked="checked">').append('<label class="prop" for="save_ovr">'+e["Override File"]+"</label>"),t.appendTo(document.body)};if(SWFUpload==undefined)var SWFUpload=function(e){this.customSettings=e.custom_settings||{},this.customSettings.queue_upload_count=0,this.cfg=e,this.eventQueue=new Array,this.movieName="SWFUpload_"+arguments.callee.movieCount++,arguments.callee.instances[this.movieName]=this,this.initSettings(this.cfg),this.loadFlash(),this.displayDebugInfo()};SWFUpload.instances={},SWFUpload.movieCount=0,SWFUpload.version="2.2.0 Beta 5 2008-01-29",SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130},SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290},SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5},SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120},SWFUpload.CURSOR={ARROW:-1,HAND:-2},SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"},SWFUpload.Console={writeLine:function(e){var t=null,n=null;try{t=document.getElementById("SWFUpload_Console"),t||(n=document.createElement("form"),document.getElementsByTagName("body")[0].appendChild(n),t=document.createElement("textarea"),t.id="SWFUpload_Console",t.style.fontFamily="monospace",t.setAttribute("wrap","off"),t.wrap="off",t.style.overflow="auto",t.style.width="700px",t.style.height="350px",t.style.margin="5px",n.appendChild(t)),t.value+=e+"\n",t.scrollTop=t.scrollHeight-t.clientHeight}catch(r){alert("Exception: "+r.name+" Message: "+r.message)}}},SWFUpload.prototype={getName:function(){return"SWFUpload"},setValue:function(e,t){this.cfg[e]||(this.cfg[e]=t)},initSettings:function(){this.setValue("upload_url",""),this.setValue("file_post_name","Filedata"),this.setValue("post_params",{}),this.setValue("use_query_string",!1),this.setValue("requeue_on_error",!1),this.setValue("http_success",[]),this.setValue("file_types","*.*"),this.setValue("file_types_description","All Files"),this.setValue("file_size_limit",0),this.setValue("file_upload_limit",0),this.setValue("file_queue_limit",0),this.setValue("flash_url","swfupload.swf"),this.setValue("prevent_swf_caching",!0),this.setValue("button_image_url",""),this.setValue("button_width",20),this.setValue("button_height",20),this.setValue("button_text","Browse..."),this.setValue("button_text_style","color: #000000; font-size: 16pt;"),this.setValue("button_text_top_padding",0),this.setValue("button_text_left_padding",0),this.setValue("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES),this.setValue("button_disabled",!1),this.setValue("button_placeholder_id",""),this.setValue("button_cursor",SWFUpload.CURSOR.ARROW),this.setValue("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW),this.setValue("debug",!1),this.cfg.debug_enabled=this.cfg.debug,this.cfg.return_upload_start_handler=this.returnUploadStart,this.setValue("swfupload_loaded_handler",null),this.setValue("file_dialog_start_handler",null),this.setValue("file_queued_handler",null),this.setValue("file_queue_error_handler",null),this.setValue("file_dialog_complete_handler",null),this.setValue("upload_start_handler",null),this.setValue("upload_progress_handler",null),this.setValue("upload_error_handler",null),this.setValue("upload_success_handler",null),this.setValue("upload_complete_handler",null),this.setValue("debug_handler",this.debugMessage),this.cfg.prevent_swf_caching&&(this.cfg.flash_url=this.cfg.flash_url+(this.cfg.flash_url.indexOf("?")==-1?"?":"&")+"preventswfcaching="+(new Date).getTime())},__destruct:function(){var e=this.getMovieElement();this.cancelUpload(null,!1);if(e&&typeof e.CallFunction=="unknown")try{for(var t in e)typeof e[t]=="function"&&(e[t]=null);e.parentNode.removeChild(e)}catch(n){}SWFUpload.instances[this.movieName]=document[this.movieName]=window[this.movieName]=null,delete SWFUpload.instances[this.movieName],this.movieName=this.eventQueue=this.cfg=this.customSettings=null},loadFlash:function(){var e=null,t=null;if(document.getElementById(this.movieName))throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";e=document.getElementById(this.cfg.button_placeholder_id);if(!e)throw"Could not find the placeholder element: "+this.cfg.button_placeholder_id;t=document.createElement("div"),t.innerHTML=this.getFlashHTML(),e.parentNode.replaceChild(t.firstChild,e),window[this.movieName]&&(window[this.movieName]=this.getMovieElement())},getFlashHTML:function(){return(new Array('<object id="',this.movieName,'" name="',this.movieName,'" type="application/x-shockwave-flash" data="',this.cfg.flash_url,'" width="'
,this.cfg.button_width,'" height="',this.cfg.button_height,'" class="swfupload">','<param name="wmode" value="',this.cfg.button_window_mode,'" />','<param name="movie" value="',this.cfg.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>")).join("")},getFlashVars:function(){var e=this.buildParamString(),t=this.cfg.http_success.join(","),n=encodeURIComponent;return(new Array("movieName=",n(this.movieName),"&amp;uploadURL=",n(this.cfg.upload_url),"&amp;useQueryString=",n(this.cfg.use_query_string),"&amp;requeueOnError=",n(this.cfg.requeue_on_error),"&amp;httpSuccess=",n(t),"&amp;params=",n(e),"&amp;filePostName=",n(this.cfg.file_post_name),"&amp;fileTypes=",n(this.cfg.file_types),"&amp;fileTypesDescription=",n(this.cfg.file_types_description),"&amp;fileSizeLimit=",n(this.cfg.file_size_limit),"&amp;fileUploadLimit=",n(this.cfg.file_upload_limit),"&amp;fileQueueLimit=",n(this.cfg.file_queue_limit),"&amp;debugEnabled=",n(this.cfg.debug_enabled),"&amp;buttonImageURL=",n(this.cfg.button_image_url),"&amp;buttonWidth=",n(this.cfg.button_width),"&amp;buttonHeight=",n(this.cfg.button_height),"&amp;buttonText=",n(this.cfg.button_text),"&amp;buttonTextTopPadding=",n(this.cfg.button_text_top_padding),"&amp;buttonTextLeftPadding=",n(this.cfg.button_text_left_padding),"&amp;buttonTextStyle=",n(this.cfg.button_text_style),"&amp;buttonAction=",n(this.cfg.button_action),"&amp;buttonDisabled=",n(this.cfg.button_disabled),"&amp;buttonCursor=",n(this.cfg.button_cursor))).join("")},getMovieElement:function(){var e=document[this.movieName]||window[this.movieName];if(!e)throw"Could not find Flash element";return e},buildParamString:function(){var e=this.cfg.post_params,t=new Array;if(typeof e=="object")for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n.toString())+"="+encodeURIComponent(e[n].toString()));return t.join("&amp;")},callFlash:function(functionName,argumentArray){var movieElement=this.getMovieElement(),returnValue=null,returnString=null;argumentArray=argumentArray||new Array;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>"),returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"}return returnValue&&typeof returnValue.post=="object"&&(returnValue=this.unescapeFilePostParams(returnValue)),returnValue},selectFile:function(){this.callFlash("SelectFile")},selectFiles:function(){this.callFlash("SelectFiles")},startUpload:function(e){this.callFlash("StartUpload",[e])},cancelUpload:function(e,t){t!==!1&&(t=!0),this.callFlash("CancelUpload",[e,t])},stopUpload:function(){this.callFlash("StopUpload")},getStats:function(){return this.callFlash("GetStats")},setStats:function(e){this.callFlash("SetStats",[e])},getFile:function(e){return this.callFlash(typeof e=="number"?"GetFileByIndex":"GetFile",[e])},addFileParam:function(e,t,n){return this.callFlash("AddFileParam",[e,t,n])},removeFileParam:function(e,t){this.callFlash("RemoveFileParam",[e,t])},setUploadURL:function(e){this.cfg.upload_url=e.toString(),this.callFlash("SetUploadURL",[e])},setPostParams:function(e){this.cfg.post_params=e,this.callFlash("SetPostParams",[e])},queueEvent:function(e,t){var n=this;t=t||new Array,t instanceof Array||(t=[t]);if(typeof this.cfg[e]!="function")throw"Event handler "+(e||"emptyNameFunction")+" is unknown or is not a function";this.eventQueue.push(function(){this.cfg[e].apply(this,t)}),window.setTimeout(function(){n.executeNextEvent()},0)},executeNextEvent:function(){var e=this.eventQueue?this.eventQueue.shift():null;typeof e=="function"&&e.call(this)},unescapeFilePostParams:function(e){var t=/[$]([0-9a-f]{4})/i,n={},r=null,i=null;if(e){for(var s in e.post)if(e.post.hasOwnProperty(s)){r=s;while((i=t.exec(r))!==null)r=r.replace(i[0],String.fromCharCode(parseInt("0x"+i[1],16)));n[r]=e.post[s]}e.post=n}return e},testExternalInterface:function(){try{return this.callFlash("TestExternalInterface")}catch(e){return!1}},flashReady:function(){var e=this.getMovieElement();if(!e){this.debug("Flash called back ready but the flash movie can't be found.");return}this.cleanUp(e),this.queueEvent("swfupload_loaded_handler")},cleanUp:function(e){if(this.getMovieElement()&&typeof e.CallFunction=="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");try{for(var t in e)typeof e[t]=="function"&&(e[t]=null)}catch(n){}}window.__flash__removeCallback=function(e,t){try{e&&(e[t]=null)}catch(n){}}},fileDialogStart:function(){this.queueEvent("file_dialog_start_handler")},fileQueued:function(e){e=this.unescapeFilePostParams(e),this.queueEvent("file_queued_handler",e)},fileQueueError:function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("file_queue_error_handler",[e,t,n])},fileDialogComplete:function(e,t){this.queueEvent("file_dialog_complete_handler",[e,t])},uploadStart:function(e){e=this.unescapeFilePostParams(e),this.queueEvent("return_upload_start_handler",e)},returnUploadStart:function(e){var t=null;if(typeof this.cfg.upload_start_handler!="function")throw"upload_start_handler must be a function";e=this.unescapeFilePostParams(e),t=this.cfg.upload_start_handler.call(this,e),t===undefined&&(t=!0),this.callFlash("ReturnUploadStart",[!!t])},uploadProgress:function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_progress_handler",[e,t,n])},uploadError:function(e,t,n){e=this.unescapeFilePostParams(e),this.queueEvent("upload_error_handler",[e,t,n])},uploadSuccess:function(e,t){e=this.unescapeFilePostParams(e),this.queueEvent("upload_success_handler",[e,t])},uploadComplete:function(e){e=this.unescapeFilePostParams(e),this.queueEvent("upload_complete_handler",e)},debug:function(e){this.queueEvent("debug_handler",e)},displayDebugInfo:function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","	","upload_url:               ",this.cfg.upload_url,"\n","	","flash_url:                ",this.cfg.flash_url,"\n","	","use_query_string:         ",this.cfg.use_query_string.toString(),"\n","	","requeue_on_error:         ",this.cfg.requeue_on_error.toString(),"\n","	","http_success:             ",this.cfg.http_success.join(", "),"\n","	","file_post_name:           ",this.cfg.file_post_name,"\n","	","post_params:              ",this.cfg.post_params.toString(),"\n","	","file_types:               ",this.cfg.file_types,"\n","	","file_types_description:   ",this.cfg.file_types_description,"\n","	","file_size_limit:          ",this.cfg.file_size_limit,"\n","	","file_upload_limit:        ",this.cfg.file_upload_limit,"\n","	","file_queue_limit:         ",this.cfg.file_queue_limit,"\n","	","debug:                    ",this.cfg.debug.toString(),"\n","	","prevent_swf_caching:      ",this.cfg.prevent_swf_caching.toString(),"\n","	","button_placeholder_id:    ",this.cfg.button_placeholder_id.toString(),"\n","	","button_image_url:         ",this.cfg.button_image_url.toString(),"\n","	","button_width:             ",this.cfg.button_width.toString(),"\n","	","button_height:            ",this.cfg.button_height.toString(),"\n","	","button_text:              ",this.cfg.button_text.toString(),"\n","	","button_text_style:        ",this.cfg.button_text_style.toString(),"\n","	","button_text_top_padding:  ",this.cfg.button_text_top_padding.toString(),"\n","	","button_text_left_padding: ",this.cfg.button_text_left_padding.toString(),"\n","	","button_action:            ",this.cfg.button_action.toString(),"\n","	","button_disabled:          ",this.cfg.button_disabled.toString(),"\n","	","custom_settings:          ",this.cfg.custom_settings.toString(),"\n","Event Handlers:","\n	","swfupload_loaded_handler assigned: ",(typeof this.cfg.swfupload_loaded_handler=="function").toString(),"\n	","file_dialog_start_handler assigned:",(typeof this.cfg.file_dialog_start_handler=="function").toString(),"\n	","file_queued_handler assigned:      ",(typeof this.cfg.file_queued_handler=="function").toString(),"\n	","file_queue_error_handler assigned:  ",(typeof this.cfg.file_queue_error_handler=="function").toString(),"\n	","upload_start_handler assigned:      ",(typeof this.cfg.upload_start_handler=="function").toString(),"\n	","upload_progress_handler assigned:   ",(typeof this.cfg.upload_progress_handler=="function").toString(),"\n	","upload_error_handler assigned:      ",(typeof this.cfg.upload_error_handler=="function").toString(),"\n	","upload_success_handler assigned:    ",(typeof this.cfg.upload_success_handler=="function").toString(),"\n	","upload_complete_handler assigned:   ",(typeof this.cfg.upload_complete_handler=="function").toString(),"\n	","debug_handler assigned:             ",(typeof this.cfg.debug_handler=="function").toString()].join(""))},debugMessage:function(e){if(this.cfg.debug){var t=null,n=new Array;if(typeof e=="object"&&typeof e.name=="string"&&typeof e.message=="string"){for(var r in e)e.hasOwnProperty(r)&&n.push(r+": "+e[r]);t=n.join("\n")||"",n=t.split("\n"),t="EXCEPTION: "+n.join("\nEXCEPTION: "),SWFUpload.Console.writeLine(t)}else SWFUpload.Console.writeLine(e)}}};var SWFUpload;typeof SWFUpload=="function"&&(SWFUpload.queue={},SWFUpload.prototype.initSettings=function(e){return function(t){typeof e=="function"&&e.call(this,t),this.customSettings.queue_cancelled_flag=!1,this.setValue("user_upload_complete_handler",t.upload_complete_handler),this.cfg.upload_complete_handler=SWFUpload.queue.uploadComplete}}(SWFUpload.prototype.initSettings),SWFUpload.prototype.cancelQueue=function(){var e=this.getStats();this.customSettings.queue_cancelled_flag=!1,e.in_progress>0&&(this.customSettings.queue_cancelled_flag=!0);while(e.files_queued>0)this.cancelUpload(),e=this.getStats()},SWFUpload.queue.uploadComplete=function(e){var t=this.cfg.user_upload_complete_handler,n=!0;typeof t=="function"&&(n=t.call(this,e)===!1);if(n){var r=this.getStats();r.files_queued>0&&this.customSettings.queue_cancelled_flag===!1?this.startUpload():this.customSettings.queue_cancelled_flag=!1}}),FileProgress.prototype={reset:function(){var e=this.element.childNodes;this.element.className="progressContainer",e[2].innerHTML="&nbsp;",e[2].className="progressBarStatus",e[3].lastChild.style.width="0%",e=null},setProgress:function(e){var t=this.element.childNodes[3];t.lastChild.style.width=e+"%",sjs.setText(t.firstChild,e),t=null},setComplete:function(){this.element.className="progressContainer progressComplete",this.element.childNodes[3].lastChild.style.width="",this.disappear(.5)},setError:function(){var e=this.element.childNodes[3];this.element.className="progressContainer progressError",e.lastChild.style.width="",sjs.setText(e.firstChild,"0");var t=this;setTimeout(function(){t.disappear(.5)},3e3)},setCancelled:function(){var e=this.element.childNodes[3];this.element.className="progressContainer progressCancelled",e.lastChild.style.width="0%",sjs.setText(e.firstChild,"0")},setStatus:function(e){sjs.setText(this.element.childNodes[2],e)},toggleCancel:function(e,t){var n=this.element.firstChild;n.style.visibility=e?"visible":"hidden",t&&sjs(n).data("file_id",this.id).onEvent("click",function(){return t.cancelUpload(sjs(this).data("file_id")),sjs(this).hide(),!1})},appear:function(e){sjs(this.element).animate("opacity",{start:0,end:1},e||.5,!0)},disappear:function(e){sjs(this.element).animate("opacity",{start:1,end:0,onEnd:function(e){sjs(e.parentNode).remove()}},e||.5,!0)}};